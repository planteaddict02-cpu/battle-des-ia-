<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle des IAs Gratuites - 100% Free</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4caf50, #8bc34a, #cddc39);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.2em;
            color: #4caf50;
            font-weight: bold;
        }

        .api-config {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .api-config h3 {
            margin-bottom: 20px;
            color: #4caf50;
        }

        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .api-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .api-item label {
            font-size: 0.9em;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .free-badge {
            background: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .api-item input {
            padding: 12px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 0.95em;
        }

        .api-item input:focus {
            outline: none;
            border-color: #4caf50;
        }

        .api-help {
            font-size: 0.85em;
            color: #888;
            padding: 15px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 10px;
            border-left: 3px solid #4caf50;
        }

        .api-help a {
            color: #4caf50;
            text-decoration: none;
            font-weight: bold;
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .leaderboard h3 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }

        .leaderboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .ai-card {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .ai-card:hover {
            border-color: #4caf50;
            transform: translateY(-5px);
        }

        .ai-card.top-1 {
            border-color: #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
        }

        .ai-card.top-2 {
            border-color: #c0c0c0;
        }

        .ai-card.top-3 {
            border-color: #cd7f32;
        }

        .ai-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .ai-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.9em;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            color: #aaa;
        }

        .stat-value {
            font-weight: bold;
            color: #4caf50;
        }

        .win-rate {
            font-size: 2em;
            font-weight: bold;
            color: #4caf50;
            margin: 10px 0;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(76, 175, 80, 0.3);
            margin-bottom: 20px;
        }

        .match-input-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .match-input-section h3 {
            margin-bottom: 20px;
            color: #4caf50;
        }

        .match-form {
            display: grid;
            gap: 20px;
        }

        .team-input-group {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 15px;
            align-items: center;
        }

        .team-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .team-field label {
            font-size: 0.9em;
            color: #aaa;
        }

        .team-field input {
            padding: 12px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            text-align: center;
        }

        .vs-text {
            font-size: 2em;
            font-weight: bold;
            color: #4caf50;
        }

        .odds-input-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .odd-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .odd-field label {
            font-size: 0.9em;
            color: #aaa;
            text-align: center;
        }

        .odd-field input {
            padding: 12px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            text-align: center;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
        }

        .analyze-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #4caf50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .predictions-section {
            display: none;
            margin-top: 30px;
        }

        .predictions-section.show {
            display: block;
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .prediction-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }

        .prediction-card.correct {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.2);
            animation: pulse 1s;
        }

        .prediction-card.incorrect {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            opacity: 0.7;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .ai-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .ai-title {
            font-size: 1.3em;
            font-weight: bold;
        }

        .confidence-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .confidence-high {
            background: #4caf50;
        }

        .confidence-medium {
            background: #ff9800;
        }

        .confidence-low {
            background: #f44336;
        }

        .prediction-result {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .prediction-details {
            font-size: 0.9em;
            color: #aaa;
            margin-top: 10px;
        }

        .reasoning {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            border-left: 3px solid #4caf50;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .result-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .result-btn {
            padding: 20px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(139, 195, 74, 0.2));
            border: 2px solid #4caf50;
            color: white;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-btn:hover {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.4), rgba(139, 195, 74, 0.4));
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #ff6b6b;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .success-message {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
            color: #4caf50;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            display: none;
            animation: slideIn 0.5s;
        }

        .success-message.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .reset-stats-btn {
            padding: 10px 20px;
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #ff6b6b;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .reset-stats-btn:hover {
            background: rgba(244, 67, 54, 0.3);
        }

        @media (max-width: 768px) {
            .team-input-group {
                grid-template-columns: 1fr;
            }
            
            .predictions-grid {
                grid-template-columns: 1fr;
            }
            
            .api-grid {
                grid-template-columns: 1fr;
            }

            .odds-input-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ BATTLE DES IAs 100% GRATUITES ‚öîÔ∏è</h1>
            <p class="subtitle">‚úÖ Aucune API Payante - 100% Free</p>
            <p>Comp√©tition entre les meilleures IAs gratuites</p>
        </div>

        <div class="leaderboard">
            <h3>üèÜ Classement des IAs</h3>
            <button class="reset-stats-btn" onclick="resetStats()">üîÑ R√©initialiser les Stats</button>
            <div class="leaderboard-grid" id="leaderboard"></div>
        </div>

        <div class="api-config">
            <h3>üîë Configuration des IAs Gratuites</h3>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <p style="color: #4caf50; font-size: 0.9em; margin: 0;">‚úÖ Les cl√©s sont sauvegard√©es automatiquement</p>
                <button onclick="clearApiKeys()" style="padding: 8px 15px; background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; color: #ff6b6b; border-radius: 8px; cursor: pointer; font-size: 0.85em;">
                    üóëÔ∏è Effacer les cl√©s
                </button>
            </div>
            <div class="api-grid">
                <div class="api-item">
                    <label>
                        ‚ú® Google Gemini <span class="free-badge">GRATUIT</span>
                    </label>
                    <input type="password" id="geminiKey" placeholder="AIza...">
                </div>
                <div class="api-item">
                    <label>
                        ‚ö° Groq (Llama 3) <span class="free-badge">GRATUIT</span>
                    </label>
                    <input type="password" id="groqKey" placeholder="gsk_...">
                </div>
                <div class="api-item">
                    <label>
                        ü§ó HuggingFace <span class="free-badge">GRATUIT</span>
                    </label>
                    <input type="password" id="huggingfaceKey" placeholder="hf_...">
                </div>
                <div class="api-item">
                    <label>
                        üåê Cohere <span class="free-badge">GRATUIT</span>
                    </label>
                    <input type="password" id="cohereKey" placeholder="...">
                </div>
            </div>
            <div class="api-help">
                <strong>üìö CLIQUE ICI POUR OBTENIR TES CL√âS API GRATUITES :</strong><br><br>
                <div style="display: grid; gap: 10px; margin-top: 10px;">
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        ‚ú® GOOGLE GEMINI - 60 req/min GRATUIT ‚Üí
                    </a>
                    <a href="https://console.groq.com/keys" target="_blank" style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        ‚ö° GROQ - 14,400 req/jour GRATUIT ‚Üí
                    </a>
                    <a href="https://huggingface.co/settings/tokens" target="_blank" style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        ü§ó HUGGINGFACE - Illimit√© GRATUIT ‚Üí
                    </a>
                    <a href="https://dashboard.cohere.com/api-keys" target="_blank" style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        üåê COHERE - 5M tokens/mois GRATUIT ‚Üí
                    </a>
                </div>
            </div>
        </div>

        <div class="main-card">
            <div class="match-input-section">
                <h3>‚öΩ Cr√©er un Match</h3>
                <div class="match-form">
                    <div class="team-input-group">
                        <div class="team-field">
                            <label>√âquipe Domicile</label>
                            <input type="text" id="team1" placeholder="Ex: Paris SG" value="Paris SG">
                        </div>
                        <div class="vs-text">VS</div>
                        <div class="team-field">
                            <label>√âquipe Ext√©rieur</label>
                            <input type="text" id="team2" placeholder="Ex: Marseille" value="Marseille">
                        </div>
                    </div>

                    <div class="odds-input-group">
                        <div class="odd-field">
                            <label>Cote 1 (Domicile)</label>
                            <input type="number" id="odd1" step="0.01" value="2.00" min="1.01">
                        </div>
                        <div class="odd-field">
                            <label>Cote X (Nul)</label>
                            <input type="number" id="oddX" step="0.01" value="3.50" min="1.01">
                        </div>
                        <div class="odd-field">
                            <label>Cote 2 (Ext√©rieur)</label>
                            <input type="number" id="odd2" step="0.01" value="3.00" min="1.01">
                        </div>
                    </div>

                    <div class="odd-field">
                        <label>üíµ Mise par Pari</label>
                        <input type="number" id="betAmount" value="10" min="1" max="100" style="max-width: 200px;">
                    </div>
                </div>
            </div>

            <button class="analyze-btn" id="analyzeBtn" onclick="battleAIs()">
                ‚öîÔ∏è LANCER LA BATTLE DES IAs !
            </button>

            <div class="error-message" id="errorMessage"></div>

            <div class="loading" id="loadingAnalysis">
                <div class="spinner"></div>
                <p>Les IAs analysent le match...</p>
            </div>

            <div class="predictions-section" id="predictionsSection">
                <h2 style="text-align: center; margin-bottom: 20px;">üìä Pr√©dictions des IAs</h2>
                <div class="predictions-grid" id="predictionsGrid"></div>

                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 25px; margin-top: 30px;">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #4caf50;">‚öΩ Enregistrer le R√©sultat</h3>
                    <p style="text-align: center; color: #aaa; margin-bottom: 20px;">
                        Clique sur le r√©sultat final du match
                    </p>
                    <div class="result-buttons">
                        <button class="result-btn" onclick="registerResult('1')">
                            <span id="team1Name">√âquipe 1</span> gagne (1)
                        </button>
                        <button class="result-btn" onclick="registerResult('X')">
                            Match Nul (X)
                        </button>
                        <button class="result-btn" onclick="registerResult('2')">
                            <span id="team2Name">√âquipe 2</span> gagne (2)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPredictions = [];
        let currentTeams = { team1: '', team2: '' };
        let currentOdds = { '1': 2.0, 'X': 3.5, '2': 3.0 };
        let aiStats = JSON.parse(localStorage.getItem('aiStats')) || {
            'Gemini (Google)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
            'Groq (Llama 3)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
            'HuggingFace': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
            'Cohere': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] }
        };

        // Migration pour les anciennes donn√©es
        Object.keys(aiStats).forEach(aiName => {
            if (typeof aiStats[aiName].totalGains === 'undefined') {
                aiStats[aiName].totalGains = 0;
                aiStats[aiName].bankroll = 100;
            }
        });

        updateLeaderboard();
        loadSavedApiKeys();

        function saveApiKeys() {
            const apiKeys = {
                gemini: document.getElementById('geminiKey').value,
                groq: document.getElementById('groqKey').value,
                huggingface: document.getElementById('huggingfaceKey').value,
                cohere: document.getElementById('cohereKey').value,
                betAmount: document.getElementById('betAmount').value
            };
            localStorage.setItem('apiKeys', JSON.stringify(apiKeys));
        }

        function loadSavedApiKeys() {
            const savedKeys = localStorage.getItem('apiKeys');
            if (savedKeys) {
                try {
                    const apiKeys = JSON.parse(savedKeys);
                    if (apiKeys.gemini) document.getElementById('geminiKey').value = apiKeys.gemini;
                    if (apiKeys.groq) document.getElementById('groqKey').value = apiKeys.groq;
                    if (apiKeys.huggingface) document.getElementById('huggingfaceKey').value = apiKeys.huggingface;
                    if (apiKeys.cohere) document.getElementById('cohereKey').value = apiKeys.cohere;
                    if (apiKeys.betAmount) document.getElementById('betAmount').value = apiKeys.betAmount;
                } catch (e) {
                    console.error('Erreur chargement cl√©s API:', e);
                }
            }
        }

        document.getElementById('geminiKey').addEventListener('input', saveApiKeys);
        document.getElementById('groqKey').addEventListener('input', saveApiKeys);
        document.getElementById('huggingfaceKey').addEventListener('input', saveApiKeys);
        document.getElementById('cohereKey').addEventListener('input', saveApiKeys);
        document.getElementById('betAmount').addEventListener('input', saveApiKeys);

        function clearApiKeys() {
            if (confirm('Voulez-vous vraiment effacer toutes les cl√©s API sauvegard√©es ?')) {
                localStorage.removeItem('apiKeys');
                document.getElementById('geminiKey').value = '';
                document.getElementById('groqKey').value = '';
                document.getElementById('huggingfaceKey').value = '';
                document.getElementById('cohereKey').value = '';
                document.getElementById('betAmount').value = '10';
                alert('‚úÖ Cl√©s API effac√©es !');
            }
        }

        function updateLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            const sorted = Object.entries(aiStats).sort((a, b) => {
                const winRateA = a[1].total > 0 ? (a[1].wins / a[1].total) * 100 : 0;
                const winRateB = b[1].total > 0 ? (b[1].wins / b[1].total) * 100 : 0;
                return winRateB - winRateA;
            });

            leaderboard.innerHTML = sorted.map(([name, stats], index) => {
                const winRate = stats.total > 0 ? ((stats.wins / stats.total) * 100).toFixed(1) : '0.0';
                const topClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
                const bankroll = stats.bankroll || 100;
                const profit = bankroll - 100;
                const profitColor = profit > 0 ? '#4caf50' : profit < 0 ? '#f44336' : '#ff9800';
                const profitSign = profit > 0 ? '+' : '';
                
                return `
                    <div class="ai-card ${topClass}">
                        <div class="ai-name">${medal} ${name}</div>
                        <div class="win-rate">${winRate}%</div>
                        <div class="ai-stats">
                            <div class="stat-row">
                                <span class="stat-label">üí∞ Bankroll</span>
                                <span class="stat-value" style="color: ${profitColor};">${bankroll.toFixed(2)}‚Ç¨</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">üìà Profit</span>
                                <span class="stat-value" style="color: ${profitColor};">${profitSign}${profit.toFixed(2)}‚Ç¨</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">‚úÖ Victoires</span>
                                <span class="stat-value">${stats.wins}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">üìä Pr√©dictions</span>
                                <span class="stat-value">${stats.total}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function resetStats() {
            if (confirm('Voulez-vous vraiment r√©initialiser toutes les statistiques ?')) {
                aiStats = {
                    'Gemini (Google)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
                    'Groq (Llama 3)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
                    'HuggingFace': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
                    'Cohere': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] }
                };
                localStorage.setItem('aiStats', JSON.stringify(aiStats));
                updateLeaderboard();
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => errorEl.classList.remove('show'), 5000);
        }

        async function battleAIs() {
            const team1 = document.getElementById('team1').value.trim();
            const team2 = document.getElementById('team2').value.trim();
            const odd1 = parseFloat(document.getElementById('odd1').value);
            const oddX = parseFloat(document.getElementById('oddX').value);
            const odd2 = parseFloat(document.getElementById('odd2').value);

            if (!team1 || !team2) {
                showError('‚ö†Ô∏è Veuillez entrer les noms des deux √©quipes');
                return;
            }

            if (odd1 < 1 || oddX < 1 || odd2 < 1) {
                showError('‚ö†Ô∏è Les cotes doivent √™tre sup√©rieures √† 1.00');
                return;
            }

            currentTeams = { team1, team2 };
            currentOdds = { '1': odd1, 'X': oddX, '2': odd2 };

            document.getElementById('loadingAnalysis').classList.add('show');
            document.getElementById('predictionsSection').classList.remove('show');

            const predictions = [];

            const geminiKey = document.getElementById('geminiKey').value;
            const groqKey = document.getElementById('groqKey').value;
            const huggingfaceKey = document.getElementById('huggingfaceKey').value;
            const cohereKey = document.getElementById('cohereKey').value;

            if (geminiKey) {
                const pred = await callGemini(geminiKey, team1, team2);
                predictions.push({ ai: 'Gemini (Google)', ...pred });
            }

            if (groqKey) {
                const pred = await callGroq(groqKey, team1, team2);
                predictions.push({ ai: 'Groq (Llama 3)', ...pred });
            }

            if (huggingfaceKey) {
                const pred = await callHuggingFace(huggingfaceKey, team1, team2);
                predictions.push({ ai: 'HuggingFace', ...pred });
            }

            if (cohereKey) {
                const pred = await callCohere(cohereKey, team1, team2);
                predictions.push({ ai: 'Cohere', ...pred });
            }

            if (predictions.length === 0) {
                showError('‚ö†Ô∏è Veuillez configurer au moins une cl√© API IA');
                document.getElementById('loadingAnalysis').classList.remove('show');
                return;
            }

            displayPredictions(predictions, team1, team2);

            document.getElementById('loadingAnalysis').classList.remove('show');
            document.getElementById('predictionsSection').classList.add('show');
        }

        async function callGemini(apiKey, team1, team2) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Expert football: pr√©dis ${team1} vs ${team2}. JSON uniquement:
{"prediction": "1"/"X"/"2", "confidence": 0-100, "probabilities": {"1": 0-100, "X": 0-100, "2": 0-100}, "reasoning": "2 phrases"}`
                            }]
                        }]
                    })
                });
                const data = await response.json();
                const content = data.candidates[0].content.parts[0].text;
                return JSON.parse(content.replace(/```json\n?|\n?```/g, ''));
            } catch (error) {
                return generateFallbackPrediction();
            }
        }

        async function callGroq(apiKey, team1, team2) {
            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'llama-3.1-70b-versatile',
                        messages: [{
                            role: 'user',
                            content: `Expert football: pr√©dis ${team1} vs ${team2}. JSON uniquement:
{"prediction": "1"/"X"/"2", "confidence": 0-100, "probabilities": {"1": 0-100, "X": 0-100, "2": 0-100}, "reasoning": "2 phrases"}`
                        }],
                        temperature: 0.7,
                        max_tokens: 300
                    })
                });
                const data = await response.json();
                const content = data.choices[0].message.content;
                return JSON.parse(content.replace(/```json\n?|\n?```/g, ''));
            } catch (error) {
                return generateFallbackPrediction();
            }
        }

        async function callHuggingFace(apiKey, team1, team2) {
            try {
                const response = await fetch('https://api-inference.huggingface.co/models/meta-llama/Meta-Llama-3-8B-Instruct', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: `Expert football: pr√©dis ${team1} vs ${team2}. JSON:
{"prediction": "1"/"X"/"2", "confidence": 0-100, "probabilities": {"1": 0-100, "X": 0-100, "2": 0-100}, "reasoning": "2 phrases"}`,
                        parameters: { max_new_tokens: 300, temperature: 0.7 }
                    })
                });
                const data = await response.json();
                const content = data[0].generated_text;
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) return JSON.parse(jsonMatch[0]);
                return generateFallbackPrediction();
            } catch (error) {
                return generateFallbackPrediction();
            }
        }

        async function callCohere(apiKey, team1, team2) {
            try {
                const response = await fetch('https://api.cohere.ai/v1/generate', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'command',
                        prompt: `Expert football: pr√©dis ${team1} vs ${team2}. JSON:
{"prediction": "1"/"X"/"2", "confidence": 0-100, "probabilities": {"1": 0-100, "X": 0-100, "2": 0-100}, "reasoning": "2 phrases"}`,
                        max_tokens: 300,
                        temperature: 0.7
                    })
                });
                const data = await response.json();
                const content = data.generations[0].text;
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) return JSON.parse(jsonMatch[0]);
                return generateFallbackPrediction();
            } catch (error) {
                return generateFallbackPrediction();
            }
        }

        function generateFallbackPrediction() {
            const outcomes = ['1', 'X', '2'];
            const prediction = outcomes[Math.floor(Math.random() * outcomes.length)];
            const probs = {
                '1': 30 + Math.random() * 30,
                'X': 20 + Math.random() * 20,
                '2': 30 + Math.random() * 30
            };
            const total = probs['1'] + probs['X'] + probs['2'];
            probs['1'] = parseFloat((probs['1'] / total * 100).toFixed(1));
            probs['X'] = parseFloat((probs['X'] / total * 100).toFixed(1));
            probs['2'] = parseFloat((probs['2'] / total * 100).toFixed(1));
            
            return {
                prediction,
                confidence: 50 + Math.random() * 30,
                probabilities: probs,
                reasoning: 'Analyse bas√©e sur les statistiques historiques et la forme actuelle des √©quipes.'
            };
        }

        function displayPredictions(predictions, team1, team2) {
            const grid = document.getElementById('predictionsGrid');
            currentPredictions = predictions;
            
            document.getElementById('team1Name').textContent = team1;
            document.getElementById('team2Name').textContent = team2;
            
            const betAmount = parseFloat(document.getElementById('betAmount').value) || 10;
            
            grid.innerHTML = predictions.map(pred => {
                const resultText = pred.prediction === '1' ? team1 : 
                                   pred.prediction === 'X' ? 'Match Nul' : team2;
                
                const confidenceClass = pred.confidence > 70 ? 'confidence-high' : 
                                        pred.confidence > 50 ? 'confidence-medium' : 'confidence-low';
                
                const potentialOdds = currentOdds[pred.prediction];
                const potentialWin = (betAmount * potentialOdds).toFixed(2);
                const potentialProfit = (potentialWin - betAmount).toFixed(2);
                
                return `
                    <div class="prediction-card" data-ai="${pred.ai}" data-prediction="${pred.prediction}">
                        <div class="ai-header">
                            <div class="ai-title">${pred.ai}</div>
                            <div class="confidence-badge ${confidenceClass}">
                                ${pred.confidence.toFixed(0)}%
                            </div>
                        </div>
                        <div class="prediction-result">
                            ${resultText}
                        </div>
                        <div class="prediction-details">
                            <strong>Probabilit√©s :</strong><br>
                            ${team1}: ${pred.probabilities['1']}%<br>
                            Nul: ${pred.probabilities['X']}%<br>
                            ${team2}: ${pred.probabilities['2']}%
                        </div>
                        <div style="background: rgba(76, 175, 80, 0.1); padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid rgba(76, 175, 80, 0.3);">
                            <strong>üí∞ Simulation de Pari :</strong><br>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Mise: ${betAmount}‚Ç¨</span>
                                <span>Cote: ${potentialOdds.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Gain potentiel:</span>
                                <span style="color: #4caf50; font-weight: bold;">${potentialWin}‚Ç¨</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Profit:</span>
                                <span style="color: #4caf50; font-weight: bold;">+${potentialProfit}‚Ç¨</span>
                            </div>
                        </div>
                        <div class="reasoning">
                            <strong>üí≠ Analyse :</strong><br>
                            ${pred.reasoning}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function registerResult(result) {
            if (currentPredictions.length === 0) {
                alert('Aucune pr√©diction √† √©valuer');
                return;
            }

            const resultText = result === '1' ? currentTeams.team1 : 
                              result === 'X' ? 'Match Nul' : 
                              currentTeams.team2;
            
            const betAmount = parseFloat(document.getElementById('betAmount').value) || 10;
            
            let winnersText = [];
            let gainsInfo = [];
            
            currentPredictions.forEach(pred => {
                aiStats[pred.ai].total++;
                
                const isCorrect = pred.prediction === result;
                let gain = 0;
                
                if (isCorrect) {
                    gain = (betAmount * currentOdds[pred.prediction]) - betAmount;
                    aiStats[pred.ai].wins++;
                    aiStats[pred.ai].bankroll = (aiStats[pred.ai].bankroll || 100) + gain;
                    aiStats[pred.ai].totalGains = (aiStats[pred.ai].totalGains || 0) + gain;
                    winnersText.push(pred.ai);
                    gainsInfo.push(`${pred.ai}: +${gain.toFixed(2)}‚Ç¨`);
                } else {
                    gain = -betAmount;
                    aiStats[pred.ai].bankroll = (aiStats[pred.ai].bankroll || 100) + gain;
                    aiStats[pred.ai].totalGains = (aiStats[pred.ai].totalGains || 0) + gain;
                }
                
                const card = document.querySelector(`[data-ai="${pred.ai}"]`);
                if (card) {
                    if (isCorrect) {
                        card.classList.add('correct');
                        const header = card.querySelector('.ai-header');
                        const gainBadge = document.createElement('div');
                        gainBadge.className = 'confidence-badge confidence-high';
                        gainBadge.textContent = `+${gain.toFixed(2)}‚Ç¨`;
                        header.appendChild(gainBadge);
                    } else {
                        card.classList.add('incorrect');
                        const header = card.querySelector('.ai-header');
                        const lossBadge = document.createElement('div');
                        lossBadge.className = 'confidence-badge';
                        lossBadge.style.background = '#f44336';
                        lossBadge.textContent = `${gain.toFixed(2)}‚Ç¨`;
                        header.appendChild(lossBadge);
                    }
                }
                
                aiStats[pred.ai].predictions.push({
                    match: `${currentTeams.team1} vs ${currentTeams.team2}`,
                    prediction: pred.prediction,
                    result: result,
                    correct: isCorrect,
                    odds: currentOdds[pred.prediction],
                    betAmount: betAmount,
                    gain: gain,
                    date: new Date().toISOString()
                });
            });

            localStorage.setItem('aiStats', JSON.stringify(aiStats));
            updateLeaderboard();

            const successMsg = document.createElement('div');
            successMsg.className = 'success-message show';
            successMsg.innerHTML = `
                ‚úÖ R√©sultat enregistr√© : <strong>${resultText}</strong><br>
                ${winnersText.length > 0 ? 
                    `üèÜ ${winnersText.length > 1 ? 'IAs gagnantes' : 'IA gagnante'}: <strong>${winnersText.join(', ')}</strong><br>
                    üí∞ Gains: ${gainsInfo.join(', ')}` : 
                    '‚ùå Aucune IA n\'a trouv√© le bon r√©sultat - Toutes perdent ' + betAmount + '‚Ç¨'}
            `;
            
            document.getElementById('predictionsSection').insertBefore(successMsg, document.getElementById('predictionsSection').firstChild);

            const buttons = document.querySelector('.result-buttons');
            buttons.style.display = 'none';

            setTimeout(() => {
                successMsg.remove();
                buttons.style.display = 'grid';
                document.querySelectorAll('.prediction-card').forEach(card => {
                    card.classList.remove('correct', 'incorrect');
                    const badges = card.querySelectorAll('.confidence-badge');
                    if (badges.length > 1) badges[badges.length - 1].remove();
                });
            }, 5000);
        }
    </script>
</body>
</html>
