<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle des IAs - Cotes R√©elles</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4caf50, #8bc34a, #cddc39);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .odds-api-section {
            background: rgba(255, 165, 0, 0.1);
            border: 2px solid #ffa500;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .odds-api-section h3 {
            color: #ffa500;
            margin-bottom: 15px;
        }

        .search-section {
            display: grid;
            gap: 15px;
        }

        .search-input {
            padding: 12px;
            border: 2px solid rgba(255, 165, 0, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1.1em;
        }

        .search-btn {
            padding: 15px;
            background: linear-gradient(135deg, #ffa500, #ff8c00);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .matches-list {
            display: grid;
            gap: 10px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .match-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 165, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .match-item:hover {
            background: rgba(255, 165, 0, 0.2);
            border-color: #ffa500;
        }

        .match-item.selected {
            background: rgba(255, 165, 0, 0.3);
            border-color: #ffa500;
        }

        .match-teams {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .match-odds {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
        }

        .odd-display {
            background: rgba(76, 175, 80, 0.2);
            padding: 5px 15px;
            border-radius: 8px;
            border: 1px solid #4caf50;
        }

        /* Reste du CSS identique... */
        .api-config {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .api-config h3 {
            margin-bottom: 20px;
            color: #4caf50;
        }

        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .api-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .api-item label {
            font-size: 0.9em;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .free-badge {
            background: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .api-item input {
            padding: 12px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 0.95em;
        }

        .api-item input:focus {
            outline: none;
            border-color: #4caf50;
        }

        .api-help {
            font-size: 0.85em;
            color: #888;
            padding: 15px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 10px;
            border-left: 3px solid #4caf50;
        }

        .api-help a {
            color: #4caf50;
            text-decoration: none;
            font-weight: bold;
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .leaderboard h3 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }

        .leaderboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .ai-card {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .ai-card:hover {
            border-color: #4caf50;
            transform: translateY(-5px);
        }

        .ai-card.top-1 {
            border-color: #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
        }

        .ai-card.top-2 {
            border-color: #c0c0c0;
        }

        .ai-card.top-3 {
            border-color: #cd7f32;
        }

        .ai-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .ai-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.9em;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            color: #aaa;
        }

        .stat-value {
            font-weight: bold;
            color: #4caf50;
        }

        .win-rate {
            font-size: 2em;
            font-weight: bold;
            color: #4caf50;
            margin: 10px 0;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(76, 175, 80, 0.3);
            margin-bottom: 20px;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
        }

        .analyze-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #4caf50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .predictions-section {
            display: none;
            margin-top: 30px;
        }

        .predictions-section.show {
            display: block;
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .prediction-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }

        .prediction-card.correct {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.2);
            animation: pulse 1s;
        }

        .prediction-card.incorrect {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            opacity: 0.7;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .reset-stats-btn {
            padding: 10px 20px;
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #ff6b6b;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .result-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .result-btn {
            padding: 20px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(139, 195, 74, 0.2));
            border: 2px solid #4caf50;
            color: white;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-btn:hover {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.4), rgba(139, 195, 74, 0.4));
            transform: translateY(-3px);
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #ff6b6b;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .success-message {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
            color: #4caf50;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            display: none;
        }

        .success-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ BATTLE DES IAs - COTES R√âELLES üìä</h1>
            <p style="color: #ffa500; font-weight: bold;">API The Odds (Cotes en temps r√©el)</p>
        </div>

        <!-- Section recherche de matchs avec cotes r√©elles -->
        <div class="odds-api-section">
            <h3>üîç Rechercher un Match avec Cotes R√©elles</h3>
            <div class="search-section">
                <input type="text" 
                       id="oddsApiKey" 
                       class="search-input" 
                       placeholder="Cl√© API The-Odds-API (gratuit)"
                       style="border-color: rgba(255, 165, 0, 0.5);">
                <p style="font-size: 0.85em; color: #888; margin: 5px 0;">
                    Obtiens ta cl√© gratuite : 
                    <a href="https://the-odds-api.com/" target="_blank" style="color: #ffa500; font-weight: bold;">
                        the-odds-api.com
                    </a> 
                    (500 requ√™tes/mois gratuites)
                </p>
                
                <select id="sportSelect" class="search-input">
                    <option value="soccer_epl">‚öΩ Premier League (Angleterre)</option>
                    <option value="soccer_france_ligue_one">‚öΩ Ligue 1 (France)</option>
                    <option value="soccer_spain_la_liga">‚öΩ La Liga (Espagne)</option>
                    <option value="soccer_germany_bundesliga">‚öΩ Bundesliga (Allemagne)</option>
                    <option value="soccer_italy_serie_a">‚öΩ Serie A (Italie)</option>
                    <option value="soccer_uefa_champs_league">‚öΩ Champions League</option>
                </select>
                
                <button class="search-btn" onclick="fetchRealOdds()">
                    üîç CHARGER LES MATCHS AVEC COTES R√âELLES
                </button>
            </div>

            <div id="matchesList" class="matches-list"></div>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard">
            <h3>üèÜ Classement des IAs</h3>
            <button class="reset-stats-btn" onclick="resetStats()">üîÑ R√©initialiser Stats</button>
            <div class="leaderboard-grid" id="leaderboard"></div>
        </div>

        <!-- Config API IAs -->
        <div class="api-config">
            <h3>üîë Configuration des IAs Gratuites</h3>
            <div class="api-grid">
                <div class="api-item">
                    <label>‚ú® Google Gemini <span class="free-badge">GRATUIT</span></label>
                    <input type="password" id="geminiKey" placeholder="AIza...">
                </div>
                <div class="api-item">
                    <label>‚ö° Groq (Llama 3) <span class="free-badge">GRATUIT</span></label>
                    <input type="password" id="groqKey" placeholder="gsk_...">
                </div>
                <div class="api-item">
                    <label>ü§ó HuggingFace <span class="free-badge">GRATUIT</span></label>
                    <input type="password" id="huggingfaceKey" placeholder="hf_...">
                </div>
                <div class="api-item">
                    <label>üåê Cohere <span class="free-badge">GRATUIT</span></label>
                    <input type="password" id="cohereKey" placeholder="...">
                </div>
            </div>
            <div class="api-help">
                <strong>üìö Obtiens tes cl√©s API gratuites :</strong><br><br>
                <div style="display: grid; gap: 10px;">
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" 
                       style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        ‚ú® Google Gemini ‚Üí
                    </a>
                    <a href="https://console.groq.com/keys" target="_blank" 
                       style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        ‚ö° Groq ‚Üí
                    </a>
                </div>
            </div>
        </div>

        <!-- Section principale -->
        <div class="main-card">
            <div id="selectedMatchInfo" style="display: none; background: rgba(255, 165, 0, 0.1); padding: 20px; border-radius: 10px; border: 2px solid #ffa500; margin-bottom: 20px;">
                <h3 style="color: #ffa500; margin-bottom: 15px;">üìä Match S√©lectionn√©</h3>
                <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 15px; align-items: center; margin-bottom: 15px;">
                    <div style="text-align: center;">
                        <div id="matchTeam1" style="font-size: 1.5em; font-weight: bold;"></div>
                    </div>
                    <div style="font-size: 2em; font-weight: bold; color: #ffa500;">VS</div>
                    <div style="text-align: center;">
                        <div id="matchTeam2" style="font-size: 1.5em; font-weight: bold;"></div>
                    </div>
                </div>
                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 15px;">
                    <div style="background: rgba(76, 175, 80, 0.2); padding: 10px 20px; border-radius: 10px; border: 1px solid #4caf50;">
                        <div style="font-size: 0.85em; color: #aaa;">Cote 1</div>
                        <div id="matchOdd1" style="font-size: 1.5em; font-weight: bold; color: #4caf50;"></div>
                    </div>
                    <div style="background: rgba(76, 175, 80, 0.2); padding: 10px 20px; border-radius: 10px; border: 1px solid #4caf50;">
                        <div style="font-size: 0.85em; color: #aaa;">Cote X</div>
                        <div id="matchOddX" style="font-size: 1.5em; font-weight: bold; color: #4caf50;"></div>
                    </div>
                    <div style="background: rgba(76, 175, 80, 0.2); padding: 10px 20px; border-radius: 10px; border: 1px solid #4caf50;">
                        <div style="font-size: 0.85em; color: #aaa;">Cote 2</div>
                        <div id="matchOdd2" style="font-size: 1.5em; font-weight: bold; color: #4caf50;"></div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <label style="color: #aaa; font-size: 0.9em;">üíµ Mise par Pari:</label>
                    <input type="number" id="betAmount" value="10" min="1" max="100" 
                           style="margin-top: 8px; padding: 12px; border: 2px solid rgba(255, 165, 0, 0.3); border-radius: 10px; background: rgba(255, 255, 255, 0.05); color: white; font-size: 1.1em; font-weight: bold; text-align: center; width: 150px;">
                </div>
            </div>

            <button class="analyze-btn" id="analyzeBtn" onclick="battleAIs()" disabled>
                ‚öîÔ∏è LANCER LA BATTLE DES IAs !
            </button>

            <div class="error-message" id="errorMessage"></div>

            <div class="loading" id="loadingAnalysis">
                <div class="spinner"></div>
                <p>Les IAs analysent le match...</p>
            </div>

            <div class="predictions-section" id="predictionsSection">
                <h2 style="text-align: center; margin-bottom: 20px;">üìä Pr√©dictions des IAs</h2>
                <div class="predictions-grid" id="predictionsGrid"></div>

                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 25px; margin-top: 30px;">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #4caf50;">‚öΩ Enregistrer le R√©sultat</h3>
                    <div class="result-buttons">
                        <button class="result-btn" onclick="registerResult('1')">
                            <span id="team1Name">√âquipe 1</span> gagne (1)
                        </button>
                        <button class="result-btn" onclick="registerResult('X')">
                            Match Nul (X)
                        </button>
                        <button class="result-btn" onclick="registerResult('2')">
                            <span id="team2Name">√âquipe 2</span> gagne (2)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPredictions = [];
        let currentTeams = { team1: '', team2: '' };
        let currentOdds = { '1': 2.0, 'X': 3.5, '2': 3.0 };
        let selectedMatch = null;
        let aiStats = JSON.parse(localStorage.getItem('aiStats')) || {
            'Gemini (Google)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
            'Groq (Llama 3)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
            'HuggingFace': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
            'Cohere': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] }
        };

        updateLeaderboard();
        loadSavedApiKeys();

        function saveApiKeys() {
            const apiKeys = {
                gemini: document.getElementById('geminiKey').value,
                groq: document.getElementById('groqKey').value,
                huggingface: document.getElementById('huggingfaceKey').value,
                cohere: document.getElementById('cohereKey').value,
                oddsApi: document.getElementById('oddsApiKey').value,
                betAmount: document.getElementById('betAmount').value
            };
            localStorage.setItem('apiKeys', JSON.stringify(apiKeys));
        }

        function loadSavedApiKeys() {
            const savedKeys = localStorage.getItem('apiKeys');
            if (savedKeys) {
                try {
                    const apiKeys = JSON.parse(savedKeys);
                    if (apiKeys.gemini) document.getElementById('geminiKey').value = apiKeys.gemini;
                    if (apiKeys.groq) document.getElementById('groqKey').value = apiKeys.groq;
                    if (apiKeys.huggingface) document.getElementById('huggingfaceKey').value = apiKeys.huggingface;
                    if (apiKeys.cohere) document.getElementById('cohereKey').value = apiKeys.cohere;
                    if (apiKeys.oddsApi) document.getElementById('oddsApiKey').value = apiKeys.oddsApi;
                    if (apiKeys.betAmount) document.getElementById('betAmount').value = apiKeys.betAmount;
                } catch (e) {
                    console.error('Erreur chargement cl√©s:', e);
                }
            }
        }

        document.getElementById('geminiKey').addEventListener('input', saveApiKeys);
        document.getElementById('groqKey').addEventListener('input', saveApiKeys);
        document.getElementById('huggingfaceKey').addEventListener('input', saveApiKeys);
        document.getElementById('cohereKey').addEventListener('input', saveApiKeys);
        document.getElementById('oddsApiKey').addEventListener('input', saveApiKeys);
        document.getElementById('betAmount').addEventListener('input', saveApiKeys);

        async function fetchRealOdds() {
            const apiKey = document.getElementById('oddsApiKey').value.trim();
            const sport = document.getElementById('sportSelect').value;

            if (!apiKey) {
                showError('‚ö†Ô∏è Entre ta cl√© API The-Odds-API');
                return;
            }

            document.getElementById('matchesList').innerHTML = '<div class="loading show"><div class="spinner"></div><p>Chargement des matchs...</p></div>';

            try {
                const response = await fetch(`https://api.the-odds-api.com/v4/sports/${sport}/odds/?apiKey=${apiKey}&regions=eu&markets=h2h&oddsFormat=decimal`);
                
                if (!response.ok) {
                    throw new Error('Erreur API');
                }

                const data = await response.json();

                if (data.length === 0) {
                    document.getElementById('matchesList').innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">Aucun match disponible pour ce championnat</p>';
                    return;
                }

                displayMatches(data);

            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('matchesList').innerHTML = '<p style="text-align: center; color: #f44336; padding: 20px;">‚ùå Erreur de chargement. V√©rifie ta cl√© API.</p>';
            }
        }

        function displayMatches(matches) {
            const matchesList = document.getElementById('matchesList');
            
            matchesList.innerHTML = matches.map((match, index) => {
                const bookmaker = match.bookmakers && match.bookmakers[0];
                if (!bookmaker) return '';

                const odds = bookmaker.markets[0].outcomes;
                const homeOdds = odds.find(o => o.name === match.home_team);
                const awayOdds = odds.find(o => o.name === match.away_team);
                const drawOdds = odds.find(o => o.name === 'Draw');

                return `
                    <div class="match-item" onclick="selectMatch(${index}, ${JSON.stringify(match).replace(/"/g, '&quot;')})">
                        <div class="match-teams">
                            ${match.home_team} vs ${match.away_team}
                        </div>
                        <div style="font-size: 0.85em; color: #aaa; margin: 5px 0;">
                            üìÖ ${new Date(match.commence_time).toLocaleString('fr-FR')}
                        </div>
                        <div class="match-odds">
                            <div class="odd-display">1: ${homeOdds?.price || 'N/A'}</div>
                            <div class="odd-display">X: ${drawOdds?.price || 'N/A'}</div>
                            <div class="odd-display">2: ${awayOdds?.price || 'N/A'}</div>
                        </div>
                        <div style="font-size: 0.75em; color: #888; margin-top: 8px;">
                            Bookmaker: ${bookmaker.title}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectMatch(index, matchData) {
            selectedMatch = matchData;

            document.querySelectorAll('.match-item').forEach((item, i) => {
                if (i === index) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });

            const bookmaker = matchData.bookmakers[0];
            const odds = bookmaker.markets[0].outcomes;
            const homeOdds = odds.find(o => o.name === matchData.home_team);
            const awayOdds = odds.find(o => o.name === matchData.away_team);
            const drawOdds = odds.find(o => o.name === 'Draw');

            currentTeams = {
                team1: matchData.home_team,
                team2: matchData.away_team
            };

            currentOdds = {
                '1': homeOdds?.price || 2.0,
                'X': drawOdds?.price || 3.5,
                '2': awayOdds?.price || 3.0
            };

            document.getElementById('matchTeam1').textContent = matchData.home_team;
            document.getElementById('matchTeam2').textContent = matchData.away_team;
            document.getElementById('matchOdd1').textContent = currentOdds['1'].toFixed(2);
            document.getElementById('matchOddX').textContent = currentOdds['X'].toFixed(2);
            document.getElementById('matchOdd2').textContent = currentOdds['2'].toFixed(2);

            document.getElementById('selectedMatchInfo').style.display = 'block';
            document.getElementById('analyzeBtn').disabled = false;
        }

        function forceNewAnalysis() {
            if (!confirm('‚ö†Ô∏è Cela va EFFACER les pr√©dictions actuelles et demander une NOUVELLE analyse aux IAs. Confirmer ?')) {
                return;
            }
            
            // Vider le cache PERMANENT
            const team1 = currentTeams.team1;
            const team2 = currentTeams.team2;
            localStorage.removeItem(`prediction_gemini_${team1}_${team2}_${currentOdds['1']}_${currentOdds['X']}_${currentOdds['2']}`);
            localStorage.removeItem(`prediction_groq_${team1}_${team2}_${currentOdds['1']}_${currentOdds['X']}_${currentOdds['2']}`);
            
            console.log('üóëÔ∏è Cache vid√© - Nouvelle analyse forc√©e');
            
            // Relancer
            battleAIs();
        }

        function updateLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            const sorted = Object.entries(aiStats).sort((a, b) => {
                const winRateA = a[1].total > 0 ? (a[1].wins / a[1].total) * 100 : 0;
                const winRateB = b[1].total > 0 ? (b[1].wins / b[1].total) * 100 : 0;
                return winRateB - winRateA;
            });

            leaderboard.innerHTML = sorted.map(([name, stats], index) => {
                const winRate = stats.total > 0 ? ((stats.wins / stats.total) * 100).toFixed(1) : '0.0';
                const topClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
                const bankroll = stats.bankroll || 100;
                const profit = bankroll - 100;
                const profitColor = profit > 0 ? '#4caf50' : profit < 0 ? '#f44336' : '#ff9800';
                const profitSign = profit > 0 ? '+' : '';
                
                return `
                    <div class="ai-card ${topClass}">
                        <div class="ai-name">${medal} ${name}</div>
                        <div class="win-rate">${winRate}%</div>
                        <div class="ai-stats">
                            <div class="stat-row">
                                <span class="stat-label">üí∞ Bankroll</span>
                                <span class="stat-value" style="color: ${profitColor};">${bankroll.toFixed(2)}‚Ç¨</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">üìà Profit</span>
                                <span class="stat-value" style="color: ${profitColor};">${profitSign}${profit.toFixed(2)}‚Ç¨</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">‚úÖ Victoires</span>
                                <span class="stat-value">${stats.wins}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">üìä Pr√©dictions</span>
                                <span class="stat-value">${stats.total}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function resetStats() {
            if (confirm('R√©initialiser toutes les stats ?')) {
                aiStats = {
                    'Gemini (Google)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
                    'Groq (Llama 3)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
                    'HuggingFace': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
                    'Cohere': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] }
                };
                localStorage.setItem('aiStats', JSON.stringify(aiStats));
                updateLeaderboard();
                alert('‚úÖ Stats r√©initialis√©es !');
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => errorEl.classList.remove('show'), 5000);
        }

        async function battleAIs() {
            if (!selectedMatch) {
                showError('‚ö†Ô∏è S√©lectionne un match d\'abord');
                return;
            }

            document.getElementById('loadingAnalysis').classList.add('show');
            document.getElementById('predictionsSection').classList.remove('show');

            const predictions = [];
            const { team1, team2 } = currentTeams;

            const geminiKey = document.getElementById('geminiKey').value;
            const groqKey = document.getElementById('groqKey').value;

            if (geminiKey) {
                const pred = await callGemini(geminiKey, team1, team2);
                pred.fromCache = localStorage.getItem(`prediction_gemini_${team1}_${team2}_${currentOdds['1']}_${currentOdds['X']}_${currentOdds['2']}`) !== null;
                predictions.push({ ai: 'Gemini (Google)', ...pred });
            }

            if (groqKey) {
                const pred = await callGroq(groqKey, team1, team2);
                pred.fromCache = localStorage.getItem(`prediction_groq_${team1}_${team2}_${currentOdds['1']}_${currentOdds['X']}_${currentOdds['2']}`) !== null;
                predictions.push({ ai: 'Groq (Llama 3)', ...pred });
            }

            if (predictions.length === 0) {
                showError('‚ö†Ô∏è Configure au moins une cl√© API IA');
                document.getElementById('loadingAnalysis').classList.remove('show');
                return;
            }

            displayPredictions(predictions, team1, team2);

            document.getElementById('loadingAnalysis').classList.remove('show');
            document.getElementById('predictionsSection').classList.add('show');
        }

        async function callGemini(apiKey, team1, team2) {
            // Cache PERMANENT - une fois analys√© = toujours pareil
            const cacheKey = `prediction_gemini_${team1}_${team2}_${currentOdds['1']}_${currentOdds['X']}_${currentOdds['2']}`;
            const cached = localStorage.getItem(cacheKey);
            
            if (cached) {
                console.log('‚úÖ Gemini: Pr√©diction en cache');
                return JSON.parse(cached);
            }

            console.log('üîÑ Gemini: Nouvelle analyse...');
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Tu es un expert football. Analyse ${team1} (domicile) vs ${team2} (ext√©rieur).
Cotes bookmaker: 1=${currentOdds['1']}, X=${currentOdds['X']}, 2=${currentOdds['2']}

R√©ponds UNIQUEMENT en JSON (pas de texte avant/apr√®s):
{
  "prediction": "1" ou "X" ou "2",
  "confidence": nombre entre 50 et 95,
  "probabilities": {"1": X, "X": Y, "2": Z},
  "reasoning": "Analyse en 2-3 phrases max"
}`
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.1,
                            topP: 0.8,
                            topK: 10
                        }
                    })
                });
                const data = await response.json();
                const content = data.candidates[0].content.parts[0].text;
                const result = JSON.parse(content.replace(/```json\n?|\n?```/g, ''));
                
                // Sauvegarder D√âFINITIVEMENT
                localStorage.setItem(cacheKey, JSON.stringify(result));
                console.log('üíæ Gemini: Pr√©diction sauvegard√©e');
                
                return result;
            } catch (error) {
                console.error('‚ùå Gemini error:', error);
                return generateFallbackPrediction();
            }
        }

        async function callGroq(apiKey, team1, team2) {
            // Cache PERMANENT - une fois analys√© = toujours pareil
            const cacheKey = `prediction_groq_${team1}_${team2}_${currentOdds['1']}_${currentOdds['X']}_${currentOdds['2']}`;
            const cached = localStorage.getItem(cacheKey);
            
            if (cached) {
                console.log('‚úÖ Groq: Pr√©diction en cache');
                return JSON.parse(cached);
            }

            console.log('üîÑ Groq: Nouvelle analyse...');
            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'llama-3.1-70b-versatile',
                        messages: [{
                            role: 'user',
                            content: `Tu es un expert football. Analyse ${team1} (domicile) vs ${team2} (ext√©rieur).
Cotes bookmaker: 1=${currentOdds['1']}, X=${currentOdds['X']}, 2=${currentOdds['2']}

R√©ponds UNIQUEMENT en JSON (pas de texte avant/apr√®s):
{
  "prediction": "1" ou "X" ou "2",
  "confidence": nombre entre 50 et 95,
  "probabilities": {"1": X, "X": Y, "2": Z},
  "reasoning": "Analyse en 2-3 phrases max"
}`
                        }],
                        temperature: 0.1,
                        max_tokens: 300,
                        seed: 12345
                    })
                });
                const data = await response.json();
                const content = data.choices[0].message.content;
                const result = JSON.parse(content.replace(/```json\n?|\n?```/g, ''));
                
                // Sauvegarder D√âFINITIVEMENT
                localStorage.setItem(cacheKey, JSON.stringify(result));
                console.log('üíæ Groq: Pr√©diction sauvegard√©e');
                
                return result;
            } catch (error) {
                console.error('‚ùå Groq error:', error);
                return generateFallbackPrediction();
            }
        }

        function generateFallbackPrediction() {
            const outcomes = ['1', 'X', '2'];
            const prediction = outcomes[Math.floor(Math.random() * outcomes.length)];
            const probs = {
                '1': 30 + Math.random() * 30,
                'X': 20 + Math.random() * 20,
                '2': 30 + Math.random() * 30
            };
            const total = probs['1'] + probs['X'] + probs['2'];
            probs['1'] = parseFloat((probs['1'] / total * 100).toFixed(1));
            probs['X'] = parseFloat((probs['X'] / total * 100).toFixed(1));
            probs['2'] = parseFloat((probs['2'] / total * 100).toFixed(1));
            
            return {
                prediction,
                confidence: 50 + Math.random() * 30,
                probabilities: probs,
                reasoning: 'Analyse bas√©e sur les statistiques historiques.'
            };
        }

        function displayPredictions(predictions, team1, team2) {
            const grid = document.getElementById('predictionsGrid');
            currentPredictions = predictions;
            
            document.getElementById('team1Name').textContent = team1;
            document.getElementById('team2Name').textContent = team2;
            
            const betAmount = parseFloat(document.getElementById('betAmount').value) || 10;
            
            grid.innerHTML = predictions.map(pred => {
                const resultText = pred.prediction === '1' ? team1 : 
                                   pred.prediction === 'X' ? 'Match Nul' : team2;
                
                const confidenceClass = pred.confidence > 70 ? 'confidence-high' : 
                                        pred.confidence > 50 ? 'confidence-medium' : 'confidence-low';
                
                const cacheBadge = pred.fromCache ? 
                    '<div style="background: rgba(76, 175, 80, 0.3); padding: 3px 10px; border-radius: 12px; font-size: 0.75em; color: #4caf50; border: 1px solid #4caf50;">üíæ EN CACHE</div>' : 
                    '<div style="background: rgba(255, 165, 0, 0.3); padding: 3px 10px; border-radius: 12px; font-size: 0.75em; color: #ffa500; border: 1px solid #ffa500;">‚ú® NOUVELLE</div>';
                
                const potentialOdds = currentOdds[pred.prediction];
                const potentialWin = (betAmount * potentialOdds).toFixed(2);
                const potentialProfit = (potentialWin - betAmount).toFixed(2);
                
                return `
                    <div class="prediction-card" data-ai="${pred.ai}" data-prediction="${pred.prediction}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid rgba(255, 255, 255, 0.1);">
                            <div style="font-size: 1.3em; font-weight: bold;">${pred.ai}</div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                ${cacheBadge}
                                <div class="confidence-badge ${confidenceClass}">
                                    ${pred.confidence.toFixed(0)}%
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 1.5em; font-weight: bold; text-align: center; margin: 15px 0; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                            ${resultText}
                        </div>
                        <div style="font-size: 0.9em; color: #aaa; margin-top: 10px;">
                            <strong>Probabilit√©s :</strong><br>
                            ${team1}: ${pred.probabilities['1']}%<br>
                            Nul: ${pred.probabilities['X']}%<br>
                            ${team2}: ${pred.probabilities['2']}%
                        </div>
                        <div style="background: rgba(76, 175, 80, 0.1); padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid rgba(76, 175, 80, 0.3);">
                            <strong>üí∞ Simulation :</strong><br>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Mise: ${betAmount}‚Ç¨</span>
                                <span>Cote: ${potentialOdds.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Gain:</span>
                                <span style="color: #4caf50; font-weight: bold;">${potentialWin}‚Ç¨</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Profit:</span>
                                <span style="color: #4caf50; font-weight: bold;">+${potentialProfit}‚Ç¨</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; border-left: 3px solid #4caf50; font-size: 0.9em; line-height: 1.6;">
                            <strong>üí≠ Analyse :</strong><br>
                            ${pred.reasoning}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function registerResult(result) {
            if (currentPredictions.length === 0) {
                alert('Aucune pr√©diction √† √©valuer');
                return;
            }

            const resultText = result === '1' ? currentTeams.team1 : 
                              result === 'X' ? 'Match Nul' : 
                              currentTeams.team2;
            
            const betAmount = parseFloat(document.getElementById('betAmount').value) || 10;
            
            let winnersText = [];
            let gainsInfo = [];
            
            currentPredictions.forEach(pred => {
                aiStats[pred.ai].total++;
                
                const isCorrect = pred.prediction === result;
                let gain = 0;
                
                if (isCorrect) {
                    gain = (betAmount * currentOdds[pred.prediction]) - betAmount;
                    aiStats[pred.ai].wins++;
                    aiStats[pred.ai].bankroll = (aiStats[pred.ai].bankroll || 100) + gain;
                    aiStats[pred.ai].totalGains = (aiStats[pred.ai].totalGains || 0) + gain;
                    winnersText.push(pred.ai);
                    gainsInfo.push(`${pred.ai}: +${gain.toFixed(2)}‚Ç¨`);
                } else {
                    gain = -betAmount;
                    aiStats[pred.ai].bankroll = (aiStats[pred.ai].bankroll || 100) + gain;
                    aiStats[pred.ai].totalGains = (aiStats[pred.ai].totalGains || 0) + gain;
                }
                
                const card = document.querySelector(`[data-ai="${pred.ai}"]`);
                if (card) {
                    if (isCorrect) {
                        card.classList.add('correct');
                    } else {
                        card.classList.add('incorrect');
                    }
                }
            });

            localStorage.setItem('aiStats', JSON.stringify(aiStats));
            updateLeaderboard();

            const successMsg = document.createElement('div');
            successMsg.className = 'success-message show';
            successMsg.innerHTML = `
                ‚úÖ R√©sultat: <strong>${resultText}</strong><br>
                ${winnersText.length > 0 ? 
                    `üèÜ Gagnant(s): <strong>${winnersText.join(', ')}</strong><br>üí∞ ${gainsInfo.join(', ')}` : 
                    '‚ùå Aucune IA correcte - Toutes perdent ' + betAmount + '‚Ç¨'}
            `;
            
            document.getElementById('predictionsSection').insertBefore(successMsg, document.getElementById('predictionsSection').firstChild);

            setTimeout(() => {
                successMsg.remove();
                document.querySelectorAll('.prediction-card').forEach(card => {
                    card.classList.remove('correct', 'incorrect');
                });
            }, 5000);
        }
    </script>
</body>
</html>
