<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle des IAs Gratuites - Pr√©dictions Football</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4caf50, #8bc34a, #cddc39);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.2em;
            color: #4caf50;
            font-weight: bold;
        }

        .api-config {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .api-config h3 {
            margin-bottom: 20px;
            color: #4caf50;
        }

        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .api-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .api-item label {
            font-size: 0.9em;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .free-badge {
            background: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .api-item input {
            padding: 12px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 0.95em;
        }

        .api-item input:focus {
            outline: none;
            border-color: #4caf50;
        }

        .api-help {
            font-size: 0.85em;
            color: #888;
            padding: 15px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 10px;
            border-left: 3px solid #4caf50;
        }

        .api-help a {
            color: #4caf50;
            text-decoration: none;
            font-weight: bold;
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .pending-matches {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        .pending-matches h3 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
            color: #ff9800;
        }

        .pending-matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .pending-match-card {
            background: rgba(255, 152, 0, 0.1);
            border: 2px solid rgba(255, 152, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }

        .pending-match-card:hover {
            border-color: #ff9800;
            transform: translateY(-3px);
        }

        .pending-match-header {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: #fff;
        }

        .pending-match-date {
            font-size: 0.85em;
            color: #aaa;
            text-align: center;
            margin-bottom: 10px;
        }

        .pending-predictions {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .pending-predictions-title {
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 10px;
        }

        .pending-prediction-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.9em;
        }

        .check-result-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            border: 2px solid #2196f3;
            color: white;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .check-result-btn:hover {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            transform: translateY(-2px);
        }

        .remove-pending-btn {
            width: 100%;
            padding: 10px;
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #ff6b6b;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            margin-top: 5px;
        }

        .remove-pending-btn:hover {
            background: rgba(244, 67, 54, 0.3);
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .leaderboard h3 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }

        .leaderboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .ai-card {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .ai-card:hover {
            border-color: #4caf50;
            transform: translateY(-5px);
        }

        .ai-card.top-1 {
            border-color: #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
        }

        .ai-card.top-2 {
            border-color: #c0c0c0;
        }

        .ai-card.top-3 {
            border-color: #cd7f32;
        }

        .ai-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .ai-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.9em;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            color: #aaa;
        }

        .stat-value {
            font-weight: bold;
            color: #4caf50;
        }

        .win-rate {
            font-size: 2em;
            font-weight: bold;
            color: #4caf50;
            margin: 10px 0;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(76, 175, 80, 0.3);
            margin-bottom: 20px;
        }

        .league-selector {
            margin-bottom: 20px;
        }

        .league-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1em;
            cursor: pointer;
        }

        .load-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .load-btn:hover {
            transform: translateY(-2px);
        }

        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .match-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .match-card:hover {
            border-color: #4caf50;
            transform: translateY(-5px);
        }

        .match-card.selected {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }

        .team {
            flex: 1;
            text-align: center;
        }

        .team-logo {
            width: 50px;
            height: 50px;
            margin: 0 auto 10px;
        }

        .team-name {
            font-size: 1.1em;
            font-weight: bold;
        }

        .vs-divider {
            font-size: 1.5em;
            font-weight: bold;
            color: #4caf50;
            margin: 0 15px;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .analyze-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #4caf50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .predictions-section {
            display: none;
            margin-top: 30px;
        }

        .predictions-section.show {
            display: block;
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .prediction-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }

        .prediction-card.winner {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .ai-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .ai-title {
            font-size: 1.3em;
            font-weight: bold;
        }

        .confidence-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .confidence-high {
            background: #4caf50;
        }

        .confidence-medium {
            background: #ff9800;
        }

        .confidence-low {
            background: #f44336;
        }

        .prediction-result {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .prediction-details {
            font-size: 0.9em;
            color: #aaa;
            margin-top: 10px;
        }

        .reasoning {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            border-left: 3px solid #4caf50;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #ff6b6b;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .reset-stats-btn {
            padding: 10px 20px;
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #ff6b6b;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .reset-stats-btn:hover {
            background: rgba(244, 67, 54, 0.3);
        }

        .result-registration {
            margin-top: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }

        .result-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .result-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-btn {
            padding: 20px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(139, 195, 74, 0.2));
            border: 2px solid #4caf50;
            color: white;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-btn:hover {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.4), rgba(139, 195, 74, 0.4));
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }

        .result-btn:active {
            transform: translateY(0);
        }

        .auto-check-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            border: 2px solid #2196f3;
            color: white;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(33, 150, 243, 0.5); }
            50% { box-shadow: 0 0 20px rgba(33, 150, 243, 0.8); }
        }

        .auto-check-btn:hover {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(33, 150, 243, 0.6);
        }

        .auto-check-btn:active {
            transform: translateY(0);
        }

        .auto-check-btn:disabled {
            background: #555;
            cursor: not-allowed;
            animation: none;
        }

        .match-status {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: bold;
        }

        .match-status.finished {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
            color: #4caf50;
        }

        .match-status.live {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #ff9800;
            color: #ff9800;
        }

        .match-status.not-started {
            background: rgba(33, 150, 243, 0.2);
            border: 2px solid #2196f3;
            color: #2196f3;
        }

        .success-message {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
            color: #4caf50;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            display: none;
            animation: slideIn 0.5s;
        }

        .success-message.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .prediction-card.correct {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.2);
            animation: pulse 1s;
        }

        .prediction-card.incorrect {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            opacity: 0.7;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @media (max-width: 768px) {
            .matches-grid {
                grid-template-columns: 1fr;
            }
            
            .predictions-grid {
                grid-template-columns: 1fr;
            }
            
            .api-grid {
                grid-template-columns: 1fr;
            }

            .result-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ BATTLE DES IAs GRATUITES ‚öîÔ∏è</h1>
            <p class="subtitle">‚úÖ 100% Gratuit - Aucun Frais</p>
            <p>Comp√©tition entre les meilleures IAs gratuites pour pr√©dire les matchs</p>
        </div>

        <div class="leaderboard">
            <h3>üèÜ Classement des IAs</h3>
            <button class="reset-stats-btn" onclick="resetStats()">üîÑ R√©initialiser les Stats</button>
            <div class="leaderboard-grid" id="leaderboard"></div>
        </div>

        <div class="pending-matches" id="pendingMatchesSection" style="display: none;">
            <h3>‚è≥ Matchs en Attente de R√©sultat</h3>
            <p style="text-align: center; color: #aaa; margin-bottom: 20px;">
                Ces matchs ont des pr√©dictions enregistr√©es en attente de r√©sultat
            </p>
            <div class="pending-matches-grid" id="pendingMatchesGrid"></div>
        </div>

        <div class="api-config">
            <h3>üîë Configuration des APIs (100% Gratuites)</h3>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <p style="color: #4caf50; font-size: 0.9em; margin: 0;">‚úÖ Les cl√©s sont sauvegard√©es automatiquement dans votre navigateur</p>
                <button onclick="clearApiKeys()" style="padding: 8px 15px; background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; color: #ff6b6b; border-radius: 8px; cursor: pointer; font-size: 0.85em;">
                    üóëÔ∏è Effacer les cl√©s
                </button>
            </div>
            <div class="api-grid">
                <div class="api-item">
                    <label>
                        ‚ú® Google Gemini <span class="free-badge">GRATUIT</span>
                    </label>
                    <input type="password" id="geminiKey" placeholder="AIza...">
                </div>
                <div class="api-item">
                    <label>
                        ‚ö° Groq (Llama 3) <span class="free-badge">GRATUIT</span>
                    </label>
                    <input type="password" id="groqKey" placeholder="gsk_...">
                </div>
                <div class="api-item">
                    <label>
                        ü§ó HuggingFace <span class="free-badge">GRATUIT</span>
                    </label>
                    <input type="password" id="huggingfaceKey" placeholder="hf_...">
                </div>
                <div class="api-item">
                    <label>
                        üåê Cohere <span class="free-badge">GRATUIT</span>
                    </label>
                    <input type="password" id="cohereKey" placeholder="...">
                </div>
            </div>
            <div class="api-grid">
                <div class="api-item">
                    <label>‚öΩ API-Football <span class="free-badge">100/jour</span></label>
                    <input type="text" id="apiFootballKey" placeholder="Cl√© API-Football">
                </div>
                <div class="api-item">
                    <label>üí∞ The Odds API (Pour les cotes) <span class="free-badge">500/mois</span></label>
                    <input type="text" id="oddsApiKey" placeholder="Optionnel - Pour cotes r√©elles">
                </div>
                <div class="api-item">
                    <label>üíµ Mise par Pari <span class="free-badge">Param√®tre</span></label>
                    <input type="number" id="betAmount" value="10" min="1" max="100" placeholder="10">
                </div>
            </div>
            <div class="api-help">
                <strong>üìö CLIQUE ICI POUR OBTENIR TES CL√âS API GRATUITES :</strong><br><br>
                <div style="display: grid; gap: 10px; margin-top: 10px;">
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        ‚ú® GOOGLE GEMINI - 60 req/min GRATUIT ‚Üí
                    </a>
                    <a href="https://console.groq.com/keys" target="_blank" style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        ‚ö° GROQ - 14,400 req/jour GRATUIT ‚Üí
                    </a>
                    <a href="https://huggingface.co/settings/tokens" target="_blank" style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        ü§ó HUGGINGFACE - Illimit√© GRATUIT ‚Üí
                    </a>
                    <a href="https://dashboard.cohere.com/api-keys" target="_blank" style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        üåê COHERE - 5M tokens/mois GRATUIT ‚Üí
                    </a>
                    <a href="https://dashboard.api-football.com/register" target="_blank" style="padding: 12px; background: rgba(76, 175, 80, 0.2); border: 2px solid #4caf50; border-radius: 8px; text-decoration: none; color: #4caf50; font-weight: bold; display: block; text-align: center;">
                        ‚öΩ API-FOOTBALL - 100 req/jour GRATUIT (matchs & r√©sultats) ‚Üí
                    </a>
                    <a href="https://the-odds-api.com/" target="_blank" style="padding: 12px; background: rgba(255, 152, 0, 0.2); border: 2px solid #ff9800; border-radius: 8px; text-decoration: none; color: #ff9800; font-weight: bold; display: block; text-align: center;">
                        üí∞ THE ODDS API - 500 req/mois GRATUIT (cotes r√©elles) ‚Üí
                    </a>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: rgba(255, 152, 0, 0.1); border-left: 3px solid #ff9800; border-radius: 5px; font-size: 0.9em;">
                    <strong>‚ÑπÔ∏è Important :</strong> Les cotes proviennent de <strong>The Odds API</strong> (gratuit). Si vous ne configurez pas cette cl√©, des cotes simul√©es seront utilis√©es pour les calculs de gains.
                </div>
            </div>
        </div>

        <div class="main-card">
            <div class="league-selector">
                <select id="leagueSelect">
                    <option value="61">Ligue 1 (France)</option>
                    <option value="39">Premier League (Angleterre)</option>
                    <option value="140">La Liga (Espagne)</option>
                    <option value="78">Bundesliga (Allemagne)</option>
                    <option value="135">Serie A (Italie)</option>
                </select>
            </div>

            <button class="load-btn" onclick="loadMatches()">üîÑ Charger les Matchs</button>

            <div class="error-message" id="errorMessage"></div>

            <div class="loading" id="loadingMatches">
                <div class="spinner"></div>
                <p>Chargement des matchs...</p>
            </div>

            <div class="matches-grid" id="matchesGrid"></div>

            <button class="analyze-btn" id="analyzeBtn" onclick="battleAIs()" disabled>
                ‚öîÔ∏è LANCER LA BATTLE DES IAs !
            </button>

            <div class="loading" id="loadingAnalysis">
                <div class="spinner"></div>
                <p>Les IAs analysent le match...</p>
            </div>

            <div class="predictions-section" id="predictionsSection">
                <h2 style="text-align: center; margin-bottom: 20px;">üìä Pr√©dictions des IAs</h2>
                <div class="predictions-grid" id="predictionsGrid"></div>
                
                <div class="result-registration" id="resultRegistration">
                    <h3 style="text-align: center; margin: 30px 0 20px 0; color: #4caf50;">‚öΩ R√©cup√©ration Automatique du R√©sultat</h3>
                    <div class="result-form">
                        <p style="text-align: center; color: #aaa; margin-bottom: 20px;">
                            Le syst√®me v√©rifie automatiquement si le match est termin√© et r√©cup√®re le score
                        </p>
                        
                        <div class="auto-check-section" style="margin-bottom: 20px;">
                            <button class="auto-check-btn" onclick="checkMatchResult()">
                                üîÑ V√©rifier le R√©sultat Automatiquement
                            </button>
                            <div id="matchStatus" style="text-align: center; margin-top: 15px; color: #aaa;"></div>
                        </div>

                        <div style="text-align: center; margin: 20px 0;">
                            <p style="color: #888; font-size: 0.9em;">‚îÄ‚îÄ‚îÄ OU enregistre manuellement ‚îÄ‚îÄ‚îÄ</p>
                        </div>

                        <div class="result-buttons">
                            <button class="result-btn" onclick="registerResult('1')">
                                <span id="team1Name">√âquipe 1</span> gagne (1)
                            </button>
                            <button class="result-btn" onclick="registerResult('X')">
                                Match Nul (X)
                            </button>
                            <button class="result-btn" onclick="registerResult('2')">
                                <span id="team2Name">√âquipe 2</span> gagne (2)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedMatch = null;
        let matchesData = [];
        let currentPredictions = [];
        let currentTeams = { team1: '', team2: '' };
        let currentMatchId = null;
        let pendingMatches = JSON.parse(localStorage.getItem('pendingMatches')) || [];
        let aiStats = JSON.parse(localStorage.getItem('aiStats')) || {
            'Gemini (Google)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
            'Groq (Llama 3)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
            'HuggingFace': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
            'Cohere': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] }
        };

        // Migration pour les anciennes donn√©es sans gains
        Object.keys(aiStats).forEach(aiName => {
            if (typeof aiStats[aiName].totalGains === 'undefined') {
                aiStats[aiName].totalGains = 0;
                aiStats[aiName].bankroll = 100;
            }
        });

        updateLeaderboard();
        updatePendingMatches();
        loadSavedApiKeys();

        // Sauvegarder les cl√©s API automatiquement
        function saveApiKeys() {
            const apiKeys = {
                gemini: document.getElementById('geminiKey').value,
                groq: document.getElementById('groqKey').value,
                huggingface: document.getElementById('huggingfaceKey').value,
                cohere: document.getElementById('cohereKey').value,
                apiFootball: document.getElementById('apiFootballKey').value,
                oddsApi: document.getElementById('oddsApiKey').value,
                betAmount: document.getElementById('betAmount').value
            };
            localStorage.setItem('apiKeys', JSON.stringify(apiKeys));
        }

        // Charger les cl√©s API sauvegard√©es
        function loadSavedApiKeys() {
            const savedKeys = localStorage.getItem('apiKeys');
            if (savedKeys) {
                try {
                    const apiKeys = JSON.parse(savedKeys);
                    if (apiKeys.gemini) document.getElementById('geminiKey').value = apiKeys.gemini;
                    if (apiKeys.groq) document.getElementById('groqKey').value = apiKeys.groq;
                    if (apiKeys.huggingface) document.getElementById('huggingfaceKey').value = apiKeys.huggingface;
                    if (apiKeys.cohere) document.getElementById('cohereKey').value = apiKeys.cohere;
                    if (apiKeys.apiFootball) document.getElementById('apiFootballKey').value = apiKeys.apiFootball;
                    if (apiKeys.oddsApi) document.getElementById('oddsApiKey').value = apiKeys.oddsApi;
                    if (apiKeys.betAmount) document.getElementById('betAmount').value = apiKeys.betAmount;
                } catch (e) {
                    console.error('Erreur chargement cl√©s API:', e);
                }
            }
        }

        // Ajouter les listeners pour sauvegarder automatiquement
        document.getElementById('geminiKey').addEventListener('input', saveApiKeys);
        document.getElementById('groqKey').addEventListener('input', saveApiKeys);
        document.getElementById('huggingfaceKey').addEventListener('input', saveApiKeys);
        document.getElementById('cohereKey').addEventListener('input', saveApiKeys);
        document.getElementById('apiFootballKey').addEventListener('input', saveApiKeys);
        document.getElementById('oddsApiKey').addEventListener('input', saveApiKeys);
        document.getElementById('betAmount').addEventListener('input', saveApiKeys);

        // Effacer les cl√©s API
        function clearApiKeys() {
            if (confirm('Voulez-vous vraiment effacer toutes les cl√©s API sauvegard√©es ?')) {
                localStorage.removeItem('apiKeys');
                document.getElementById('geminiKey').value = '';
                document.getElementById('groqKey').value = '';
                document.getElementById('huggingfaceKey').value = '';
                document.getElementById('cohereKey').value = '';
                document.getElementById('apiFootballKey').value = '';
                document.getElementById('oddsApiKey').value = '';
                document.getElementById('betAmount').value = '10';
                alert('‚úÖ Cl√©s API effac√©es !');
            }
        }

        function updateLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            const sorted = Object.entries(aiStats).sort((a, b) => {
                const winRateA = a[1].total > 0 ? (a[1].wins / a[1].total) * 100 : 0;
                const winRateB = b[1].total > 0 ? (b[1].wins / b[1].total) * 100 : 0;
                return winRateB - winRateA;
            });

            leaderboard.innerHTML = sorted.map(([name, stats], index) => {
                const winRate = stats.total > 0 ? ((stats.wins / stats.total) * 100).toFixed(1) : '0.0';
                const topClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
                const bankroll = stats.bankroll || 100;
                const profit = bankroll - 100;
                const profitColor = profit > 0 ? '#4caf50' : profit < 0 ? '#f44336' : '#ff9800';
                const profitSign = profit > 0 ? '+' : '';
                
                return `
                    <div class="ai-card ${topClass}">
                        <div class="ai-name">${medal} ${name}</div>
                        <div class="win-rate">${winRate}%</div>
                        <div class="ai-stats">
                            <div class="stat-row">
                                <span class="stat-label">üí∞ Bankroll</span>
                                <span class="stat-value" style="color: ${profitColor};">${bankroll.toFixed(2)}‚Ç¨</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">üìà Profit</span>
                                <span class="stat-value" style="color: ${profitColor};">${profitSign}${profit.toFixed(2)}‚Ç¨</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">‚úÖ Victoires</span>
                                <span class="stat-value">${stats.wins}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">üìä Pr√©dictions</span>
                                <span class="stat-value">${stats.total}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">üéØ Win Rate</span>
                                <span class="stat-value">${winRate}%</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updatePendingMatches() {
            const section = document.getElementById('pendingMatchesSection');
            const grid = document.getElementById('pendingMatchesGrid');

            if (pendingMatches.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            grid.innerHTML = pendingMatches.map((match, index) => {
                const matchDate = new Date(match.date);
                const predictionsHtml = match.predictions.map(pred => 
                    `<div class="pending-prediction-item">
                        <span>${pred.ai}</span>
                        <span style="color: #4caf50; font-weight: bold;">${pred.prediction}</span>
                    </div>`
                ).join('');

                return `
                    <div class="pending-match-card">
                        <div class="pending-match-header">
                            ${match.team1} vs ${match.team2}
                        </div>
                        <div class="pending-match-date">
                            üìÖ ${matchDate.toLocaleDateString('fr-FR', {
                                day: 'numeric',
                                month: 'long',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </div>
                        <div class="pending-predictions">
                            <div class="pending-predictions-title">ü§ñ Pr√©dictions des IAs :</div>
                            ${predictionsHtml}
                        </div>
                        <button class="check-result-btn" onclick="checkPendingMatch(${index})">
                            üîÑ V√©rifier le R√©sultat
                        </button>
                        <button class="remove-pending-btn" onclick="removePendingMatch(${index})">
                            ‚ùå Retirer de la liste
                        </button>
                    </div>
                `;
            }).join('');
        }

        async function checkPendingMatch(index) {
            const match = pendingMatches[index];
            const apiKey = document.getElementById('apiFootballKey').value;

            if (!apiKey) {
                showError('‚ö†Ô∏è Veuillez entrer votre cl√© API-Football');
                return;
            }

            try {
                const response = await fetch(
                    `https://v3.football.api-sports.io/fixtures?id=${match.matchId}`,
                    {
                        headers: {
                            'x-rapidapi-host': 'v3.football.api-sports.io',
                            'x-rapidapi-key': apiKey
                        }
                    }
                );

                const data = await response.json();
                
                if (!data.response || data.response.length === 0) {
                    throw new Error('Match non trouv√©');
                }

                const fixture = data.response[0];
                const status = fixture.fixture.status.short;
                const homeScore = fixture.goals.home;
                const awayScore = fixture.goals.away;
                
                if (status === 'FT' || status === 'AET' || status === 'PEN') {
                    // Match termin√© - d√©terminer le r√©sultat
                    let result;
                    if (homeScore > awayScore) {
                        result = '1';
                    } else if (homeScore < awayScore) {
                        result = '2';
                    } else {
                        result = 'X';
                    }

                    // R√©cup√©rer la mise et les cotes
                    const betAmount = parseFloat(document.getElementById('betAmount').value) || 10;
                    const odds = match.odds || { '1': 2.0, 'X': 3.5, '2': 2.5 };

                    // Mettre √† jour les stats des IAs
                    let winnersText = [];
                    let gainsInfo = [];
                    
                    match.predictions.forEach(pred => {
                        aiStats[pred.ai].total++;
                        
                        const isCorrect = pred.prediction === result;
                        let gain = 0;
                        
                        if (isCorrect) {
                            gain = (betAmount * odds[pred.prediction]) - betAmount;
                            aiStats[pred.ai].wins++;
                            aiStats[pred.ai].bankroll = (aiStats[pred.ai].bankroll || 100) + gain;
                            aiStats[pred.ai].totalGains = (aiStats[pred.ai].totalGains || 0) + gain;
                            winnersText.push(pred.ai);
                            gainsInfo.push(`${pred.ai}: +${gain.toFixed(2)}‚Ç¨`);
                        } else {
                            gain = -betAmount;
                            aiStats[pred.ai].bankroll = (aiStats[pred.ai].bankroll || 100) + gain;
                            aiStats[pred.ai].totalGains = (aiStats[pred.ai].totalGains || 0) + gain;
                        }

                        aiStats[pred.ai].predictions.push({
                            match: `${match.team1} vs ${match.team2}`,
                            prediction: pred.prediction,
                            result: result,
                            correct: isCorrect,
                            odds: odds[pred.prediction],
                            betAmount: betAmount,
                            gain: gain,
                            date: new Date().toISOString()
                        });
                    });

                    // Sauvegarder les stats
                    localStorage.setItem('aiStats', JSON.stringify(aiStats));

                    // Retirer le match des matchs en attente
                    pendingMatches.splice(index, 1);
                    localStorage.setItem('pendingMatches', JSON.stringify(pendingMatches));

                    // Mettre √† jour l'affichage
                    updateLeaderboard();
                    updatePendingMatches();

                    // Afficher le r√©sultat
                    alert(`‚úÖ Match termin√© !\n\nScore: ${match.team1} ${homeScore} - ${awayScore} ${match.team2}\nR√©sultat: ${result}\n\n${winnersText.length > 0 ? `üèÜ IAs gagnantes: ${winnersText.join(', ')}\nüí∞ Gains: ${gainsInfo.join(', ')}` : '‚ùå Aucune IA n\'a trouv√© le bon r√©sultat - Toutes perdent ' + betAmount + '‚Ç¨'}`);

                } else if (status === '1H' || status === '2H' || status === 'HT' || status === 'ET' || status === 'BT' || status === 'P' || status === 'LIVE') {
                    alert(`‚öΩ Match EN COURS !\n\nScore actuel: ${match.team1} ${homeScore} - ${awayScore} ${match.team2}\n\nReviens plus tard pour le r√©sultat final.`);
                } else if (status === 'NS' || status === 'TBD') {
                    const kickoffDate = new Date(fixture.fixture.date);
                    alert(`‚è∞ Match pas encore commenc√©\n\nCoup d'envoi: ${kickoffDate.toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'long',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}`);
                } else {
                    alert(`‚ÑπÔ∏è Statut du match: ${status}\n\nV√©rifiez plus tard ou enregistrez manuellement le r√©sultat.`);
                }

            } catch (error) {
                alert(`‚ùå Erreur lors de la v√©rification: ${error.message}`);
            }
        }

        function removePendingMatch(index) {
            if (confirm('Voulez-vous vraiment retirer ce match de la liste ?')) {
                pendingMatches.splice(index, 1);
                localStorage.setItem('pendingMatches', JSON.stringify(pendingMatches));
                updatePendingMatches();
            }
        }

        function resetStats() {
            if (confirm('Voulez-vous vraiment r√©initialiser toutes les statistiques ?')) {
                aiStats = {
                    'Gemini (Google)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
                    'Groq (Llama 3)': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
                    'HuggingFace': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] },
                    'Cohere': { wins: 0, total: 0, totalGains: 0, bankroll: 100, predictions: [] }
                };
                localStorage.setItem('aiStats', JSON.stringify(aiStats));
                updateLeaderboard();
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => errorEl.classList.remove('show'), 5000);
        }

        async function loadMatches() {
            const apiKey = document.getElementById('apiFootballKey').value;
            const leagueId = document.getElementById('leagueSelect').value;

            if (!apiKey) {
                showError('‚ö†Ô∏è Veuillez entrer votre cl√© API-Football');
                return;
            }

            document.getElementById('loadingMatches').classList.add('show');
            document.getElementById('matchesGrid').innerHTML = '';
            matchesData = [];

            try {
                const today = new Date();
                const nextWeek = new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000);
                
                const response = await fetch(
                    `https://v3.football.api-sports.io/fixtures?league=${leagueId}&season=2024&from=${today.toISOString().split('T')[0]}&to=${nextWeek.toISOString().split('T')[0]}`,
                    {
                        headers: {
                            'x-rapidapi-host': 'v3.football.api-sports.io',
                            'x-rapidapi-key': apiKey
                        }
                    }
                );

                const data = await response.json();
                
                if (data.errors && Object.keys(data.errors).length > 0) {
                    throw new Error('Cl√© API invalide');
                }

                if (!data.response || data.response.length === 0) {
                    showError('Aucun match trouv√©');
                    return;
                }

                matchesData = data.response.slice(0, 12);
                
                // R√©cup√©rer les cotes pour chaque match
                const oddsApiKey = document.getElementById('oddsApiKey').value;
                if (oddsApiKey) {
                    try {
                        const leagueMap = {
                            '61': 'soccer_france_ligue_one',
                            '39': 'soccer_epl',
                            '140': 'soccer_spain_la_liga',
                            '78': 'soccer_germany_bundesliga',
                            '135': 'soccer_italy_serie_a'
                        };
                        
                        const oddsLeague = leagueMap[leagueId];
                        if (oddsLeague) {
                            const oddsResponse = await fetch(
                                `https://api.the-odds-api.com/v4/sports/${oddsLeague}/odds/?apiKey=${oddsApiKey}&regions=eu&markets=h2h&oddsFormat=decimal`
                            );
                            const oddsData = await oddsResponse.json();
                            
                            // Associer les cotes aux matchs
                            matchesData.forEach(match => {
                                const matchOdds = oddsData.find(o => 
                                    o.home_team.toLowerCase().includes(match.teams.home.name.toLowerCase().split(' ')[0]) &&
                                    o.away_team.toLowerCase().includes(match.teams.away.name.toLowerCase().split(' ')[0])
                                );
                                
                                if (matchOdds && matchOdds.bookmakers && matchOdds.bookmakers.length > 0) {
                                    const book = matchOdds.bookmakers[0];
                                    const market = book.markets.find(m => m.key === 'h2h');
                                    if (market && market.outcomes) {
                                        match.odds = {
                                            '1': market.outcomes.find(o => o.name === matchOdds.home_team)?.price || 2.0,
                                            'X': market.outcomes.find(o => o.name === 'Draw')?.price || 3.5,
                                            '2': market.outcomes.find(o => o.name === matchOdds.away_team)?.price || 2.0
                                        };
                                        match.bookmaker = book.title;
                                    }
                                } else {
                                    // Cotes par d√©faut
                                    match.odds = { '1': 2.0, 'X': 3.5, '2': 2.5 };
                                    match.bookmaker = 'Simulation';
                                }
                            });
                        }
                    } catch (e) {
                        console.log('Cotes non disponibles:', e);
                        // Cotes par d√©faut pour tous les matchs
                        matchesData.forEach(match => {
                            match.odds = { '1': 2.0, 'X': 3.5, '2': 2.5 };
                            match.bookmaker = 'Simulation';
                        });
                    }
                } else {
                    // Pas de cl√© Odds API - utiliser des cotes par d√©faut
                    matchesData.forEach(match => {
                        match.odds = { '1': 2.0, 'X': 3.5, '2': 2.5 };
                        match.bookmaker = 'Simulation';
                    });
                }
                
                displayMatches(matchesData);

            } catch (error) {
                showError('‚ùå Erreur: ' + error.message);
            }

            document.getElementById('loadingMatches').classList.remove('show');
        }

        function displayMatches(matches) {
            const grid = document.getElementById('matchesGrid');
            grid.innerHTML = matches.map((match, index) => {
                const matchDate = new Date(match.fixture.date);
                return `
                    <div class="match-card" onclick="selectMatch(${index})">
                        <div style="font-size: 0.85em; color: #aaa; margin-bottom: 10px;">
                            üìÖ ${matchDate.toLocaleDateString('fr-FR', { 
                                weekday: 'short', 
                                day: 'numeric', 
                                month: 'short',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </div>
                        <div class="match-teams">
                            <div class="team">
                                <img src="${match.teams.home.logo}" class="team-logo" alt="${match.teams.home.name}">
                                <div class="team-name">${match.teams.home.name}</div>
                            </div>
                            <div class="vs-divider">VS</div>
                            <div class="team">
                                <img src="${match.teams.away.logo}" class="team-logo" alt="${match.teams.away.name}">
                                <div class="team-name">${match.teams.away.name}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectMatch(index) {
            selectedMatch = index;
            document.querySelectorAll('.match-card').forEach((card, i) => {
                card.classList.toggle('selected', i === index);
            });
            document.getElementById('analyzeBtn').disabled = false;
        }

        async function battleAIs() {
            if (selectedMatch === null) return;

            const match = matchesData[selectedMatch];
            const team1 = match.teams.home.name;
            const team2 = match.teams.away.name;
            
            // Sauvegarder l'ID du match actuel
            currentMatchId = match.fixture.id;

            document.getElementById('loadingAnalysis').classList.add('show');
            document.getElementById('predictionsSection').classList.remove('show');

            const predictions = [];

            const geminiKey = document.getElementById('geminiKey').value;
            const groqKey = document.getElementById('groqKey').value;
            const huggingfaceKey = document.getElementById('huggingfaceKey').value;
            const cohereKey = document.getElementById('cohereKey').value;

            if (geminiKey) {
                const pred = await callGemini(geminiKey, team1, team2);
                predictions.push({ ai: 'Gemini (Google)', ...pred });
            }

            if (groqKey) {
                const pred = await callGroq(groqKey, team1, team2);
                predictions.push({ ai: 'Groq (Llama 3)', ...pred });
            }

            if (huggingfaceKey) {
                const pred = await callHuggingFace(huggingfaceKey, team1, team2);
                predictions.push({ ai: 'HuggingFace', ...pred });
            }

            if (cohereKey) {
                const pred = await callCohere(cohereKey, team1, team2);
                predictions.push({ ai: 'Cohere', ...pred });
            }

            if (predictions.length === 0) {
                showError('‚ö†Ô∏è Veuillez configurer au moins une cl√© API IA');
                document.getElementById('loadingAnalysis').classList.remove('show');
                return;
            }

            displayPredictions(predictions, team1, team2);

            document.getElementById('loadingAnalysis').classList.remove('show');
            document.getElementById('predictionsSection').classList.add('show');
        }

        async function callGemini(apiKey, team1, team2) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Tu es un expert en analyse de matchs de football. Pr√©dis le r√©sultat du match ${team1} vs ${team2}.

R√©ponds UNIQUEMENT en JSON (sans markdown, sans explication):
{
  "prediction": "1" ou "X" ou "2",
  "confidence": 0-100,
  "probabilities": {"1": 0-100, "X": 0-100, "2": 0-100},
  "reasoning": "explication en 2 phrases"
}`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                const content = data.candidates[0].content.parts[0].text;
                return JSON.parse(content.replace(/```json\n?|\n?```/g, ''));
            } catch (error) {
                console.error('Gemini error:', error);
                return generateFallbackPrediction();
            }
        }

        async function callGroq(apiKey, team1, team2) {
            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'llama-3.1-70b-versatile',
                        messages: [{
                            role: 'user',
                            content: `Expert football: pr√©dis ${team1} vs ${team2}. JSON uniquement:
{
  "prediction": "1"/"X"/"2",
  "confidence": 0-100,
  "probabilities": {"1": 0-100, "X": 0-100, "2": 0-100},
  "reasoning": "2 phrases"
}`
                        }],
                        temperature: 0.7,
                        max_tokens: 300
                    })
                });

                const data = await response.json();
                const content = data.choices[0].message.content;
                return JSON.parse(content.replace(/```json\n?|\n?```/g, ''));
            } catch (error) {
                console.error('Groq error:', error);
                return generateFallbackPrediction();
            }
        }

        async function callHuggingFace(apiKey, team1, team2) {
            try {
                const response = await fetch('https://api-inference.huggingface.co/models/meta-llama/Meta-Llama-3-8B-Instruct', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: `Expert football: pr√©dis ${team1} vs ${team2}. JSON uniquement:
{
  "prediction": "1"/"X"/"2",
  "confidence": 0-100,
  "probabilities": {"1": 0-100, "X": 0-100, "2": 0-100},
  "reasoning": "2 phrases"
}`,
                        parameters: {
                            max_new_tokens: 300,
                            temperature: 0.7
                        }
                    })
                });

                const data = await response.json();
                const content = data[0].generated_text;
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
                return generateFallbackPrediction();
            } catch (error) {
                console.error('HuggingFace error:', error);
                return generateFallbackPrediction();
            }
        }

        async function callCohere(apiKey, team1, team2) {
            try {
                const response = await fetch('https://api.cohere.ai/v1/generate', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'command',
                        prompt: `Expert football: pr√©dis ${team1} vs ${team2}. JSON uniquement:
{
  "prediction": "1"/"X"/"2",
  "confidence": 0-100,
  "probabilities": {"1": 0-100, "X": 0-100, "2": 0-100},
  "reasoning": "2 phrases"
}`,
                        max_tokens: 300,
                        temperature: 0.7
                    })
                });

                const data = await response.json();
                const content = data.generations[0].text;
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
                return generateFallbackPrediction();
            } catch (error) {
                console.error('Cohere error:', error);
                return generateFallbackPrediction();
            }
        }

        function generateFallbackPrediction() {
            const outcomes = ['1', 'X', '2'];
            const prediction = outcomes[Math.floor(Math.random() * outcomes.length)];
            const probs = {
                '1': 30 + Math.random() * 30,
                'X': 20 + Math.random() * 20,
                '2': 30 + Math.random() * 30
            };
            const total = probs['1'] + probs['X'] + probs['2'];
            probs['1'] = parseFloat((probs['1'] / total * 100).toFixed(1));
            probs['X'] = parseFloat((probs['X'] / total * 100).toFixed(1));
            probs['2'] = parseFloat((probs['2'] / total * 100).toFixed(1));
            
            return {
                prediction,
                confidence: 50 + Math.random() * 30,
                probabilities: probs,
                reasoning: 'Analyse bas√©e sur les statistiques historiques et la forme actuelle des √©quipes.'
            };
        }

        function displayPredictions(predictions, team1, team2) {
            const grid = document.getElementById('predictionsGrid');
            
            // Sauvegarder les pr√©dictions actuelles
            currentPredictions = predictions;
            currentTeams = { team1, team2 };
            
            // R√©cup√©rer les cotes du match
            const match = matchesData[selectedMatch];
            const odds = match.odds || { '1': 2.0, 'X': 3.5, '2': 2.5 };
            
            // Sauvegarder dans les matchs en attente
            const existingIndex = pendingMatches.findIndex(m => m.matchId === currentMatchId);
            if (existingIndex === -1) {
                // Nouveau match
                pendingMatches.push({
                    matchId: currentMatchId,
                    team1: team1,
                    team2: team2,
                    date: matchesData[selectedMatch].fixture.date,
                    odds: odds,
                    predictions: predictions.map(p => ({
                        ai: p.ai,
                        prediction: p.prediction,
                        confidence: p.confidence
                    })),
                    timestamp: new Date().toISOString()
                });
            } else {
                // Mettre √† jour un match existant
                pendingMatches[existingIndex] = {
                    ...pendingMatches[existingIndex],
                    odds: odds,
                    predictions: predictions.map(p => ({
                        ai: p.ai,
                        prediction: p.prediction,
                        confidence: p.confidence
                    })),
                    timestamp: new Date().toISOString()
                };
            }
            
            localStorage.setItem('pendingMatches', JSON.stringify(pendingMatches));
            updatePendingMatches();
            
            // Mettre √† jour les noms dans les boutons
            document.getElementById('team1Name').textContent = team1;
            document.getElementById('team2Name').textContent = team2;
            
            grid.innerHTML = predictions.map(pred => {
                const resultText = pred.prediction === '1' ? team1 : 
                                   pred.prediction === 'X' ? 'Match Nul' : team2;
                
                const confidenceClass = pred.confidence > 70 ? 'confidence-high' : 
                                        pred.confidence > 50 ? 'confidence-medium' : 'confidence-low';
                
                const potentialOdds = odds[pred.prediction];
                const betAmount = parseFloat(document.getElementById('betAmount').value) || 10;
                const potentialWin = (betAmount * potentialOdds).toFixed(2);
                const potentialProfit = (potentialWin - betAmount).toFixed(2);
                
                return `
                    <div class="prediction-card" data-ai="${pred.ai}" data-prediction="${pred.prediction}">
                        <div class="ai-header">
                            <div class="ai-title">${pred.ai}</div>
                            <div class="confidence-badge ${confidenceClass}">
                                ${pred.confidence.toFixed(0)}%
                            </div>
                        </div>
                        <div class="prediction-result">
                            ${resultText}
                        </div>
                        <div class="prediction-details">
                            <strong>Probabilit√©s :</strong><br>
                            ${team1}: ${pred.probabilities['1']}%<br>
                            Nul: ${pred.probabilities['X']}%<br>
                            ${team2}: ${pred.probabilities['2']}%
                        </div>
                        <div style="background: rgba(76, 175, 80, 0.1); padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid rgba(76, 175, 80, 0.3);">
                            <strong>üí∞ Simulation de Pari :</strong><br>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Mise: ${betAmount}‚Ç¨</span>
                                <span>Cote: ${potentialOdds.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Gain potentiel:</span>
                                <span style="color: #4caf50; font-weight: bold;">${potentialWin}‚Ç¨</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Profit:</span>
                                <span style="color: #4caf50; font-weight: bold;">+${potentialProfit}‚Ç¨</span>
                            </div>
                        </div>
                        <div class="reasoning">
                            <strong>üí≠ Analyse :</strong><br>
                            ${pred.reasoning}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function registerResult(result) {
            if (currentPredictions.length === 0) {
                alert('Aucune pr√©diction √† √©valuer');
                return;
            }

            // Cr√©er le message de succ√®s
            const resultText = result === '1' ? currentTeams.team1 : 
                              result === 'X' ? 'Match Nul' : 
                              currentTeams.team2;
            
            // R√©cup√©rer les cotes
            const match = matchesData[selectedMatch];
            const odds = match.odds || { '1': 2.0, 'X': 3.5, '2': 2.5 };
            const betAmount = parseFloat(document.getElementById('betAmount').value) || 10;
            
            // Mettre √† jour les stats
            let winnersText = [];
            let gainsInfo = [];
            
            currentPredictions.forEach(pred => {
                // Incr√©menter le total
                aiStats[pred.ai].total++;
                
                // V√©rifier si la pr√©diction est correcte
                const isCorrect = pred.prediction === result;
                
                // Calculer les gains
                let gain = 0;
                if (isCorrect) {
                    gain = (betAmount * odds[pred.prediction]) - betAmount;
                    aiStats[pred.ai].wins++;
                    aiStats[pred.ai].bankroll = (aiStats[pred.ai].bankroll || 100) + gain;
                    aiStats[pred.ai].totalGains = (aiStats[pred.ai].totalGains || 0) + gain;
                    winnersText.push(pred.ai);
                    gainsInfo.push(`${pred.ai}: +${gain.toFixed(2)}‚Ç¨`);
                } else {
                    gain = -betAmount;
                    aiStats[pred.ai].bankroll = (aiStats[pred.ai].bankroll || 100) + gain;
                    aiStats[pred.ai].totalGains = (aiStats[pred.ai].totalGains || 0) + gain;
                }
                
                // Mettre √† jour les cartes visuellement
                const card = document.querySelector(`[data-ai="${pred.ai}"]`);
                if (card) {
                    if (isCorrect) {
                        card.classList.add('correct');
                        // Ajouter badge de gain
                        const header = card.querySelector('.ai-header');
                        const gainBadge = document.createElement('div');
                        gainBadge.className = 'confidence-badge confidence-high';
                        gainBadge.textContent = `+${gain.toFixed(2)}‚Ç¨`;
                        header.appendChild(gainBadge);
                    } else {
                        card.classList.add('incorrect');
                        // Ajouter badge de perte
                        const header = card.querySelector('.ai-header');
                        const lossBadge = document.createElement('div');
                        lossBadge.className = 'confidence-badge';
                        lossBadge.style.background = '#f44336';
                        lossBadge.textContent = `${gain.toFixed(2)}‚Ç¨`;
                        header.appendChild(lossBadge);
                    }
                }
                
                // Sauvegarder dans l'historique
                aiStats[pred.ai].predictions.push({
                    match: `${currentTeams.team1} vs ${currentTeams.team2}`,
                    prediction: pred.prediction,
                    result: result,
                    correct: isCorrect,
                    odds: odds[pred.prediction],
                    betAmount: betAmount,
                    gain: gain,
                    date: new Date().toISOString()
                });
            });

            // Sauvegarder dans localStorage
            localStorage.setItem('aiStats', JSON.stringify(aiStats));

            // Retirer le match des matchs en attente
            const pendingIndex = pendingMatches.findIndex(m => m.matchId === currentMatchId);
            if (pendingIndex !== -1) {
                pendingMatches.splice(pendingIndex, 1);
                localStorage.setItem('pendingMatches', JSON.stringify(pendingMatches));
                updatePendingMatches();
            }

            // Mettre √† jour le leaderboard
            updateLeaderboard();

            // Afficher le message de succ√®s
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message show';
            successMsg.innerHTML = `
                ‚úÖ R√©sultat enregistr√© : <strong>${resultText}</strong><br>
                ${winnersText.length > 0 ? 
                    `üèÜ ${winnersText.length > 1 ? 'IAs gagnantes' : 'IA gagnante'}: <strong>${winnersText.join(', ')}</strong><br>
                    üí∞ Gains: ${gainsInfo.join(', ')}` : 
                    '‚ùå Aucune IA n\'a trouv√© le bon r√©sultat - Toutes perdent ' + betAmount + '‚Ç¨'}
            `;
            
            const resultSection = document.getElementById('resultRegistration');
            resultSection.insertBefore(successMsg, resultSection.firstChild);

            // Cacher les boutons apr√®s enregistrement
            const buttons = document.querySelector('.result-buttons');
            buttons.style.display = 'none';

            // Faire d√©filer vers le message
            successMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // R√©initialiser apr√®s 5 secondes
            setTimeout(() => {
                successMsg.remove();
                buttons.style.display = 'grid';
            }, 5000);
        }

        async function checkMatchResult() {
            if (!currentMatchId) {
                alert('Aucun match s√©lectionn√©');
                return;
            }

            const apiKey = document.getElementById('apiFootballKey').value;
            if (!apiKey) {
                showError('‚ö†Ô∏è Veuillez entrer votre cl√© API-Football');
                return;
            }

            const statusDiv = document.getElementById('matchStatus');
            const btn = document.querySelector('.auto-check-btn');
            
            btn.disabled = true;
            btn.textContent = 'üîÑ V√©rification en cours...';
            statusDiv.innerHTML = '<div class="spinner" style="width: 30px; height: 30px; margin: 10px auto;"></div>';

            try {
                const response = await fetch(
                    `https://v3.football.api-sports.io/fixtures?id=${currentMatchId}`,
                    {
                        headers: {
                            'x-rapidapi-host': 'v3.football.api-sports.io',
                            'x-rapidapi-key': apiKey
                        }
                    }
                );

                const data = await response.json();
                
                if (!data.response || data.response.length === 0) {
                    throw new Error('Match non trouv√©');
                }

                const fixture = data.response[0];
                const status = fixture.fixture.status.short;
                const homeScore = fixture.goals.home;
                const awayScore = fixture.goals.away;
                
                // V√©rifier le statut du match
                if (status === 'FT' || status === 'AET' || status === 'PEN') {
                    // Match termin√©
                    let result;
                    if (homeScore > awayScore) {
                        result = '1';
                    } else if (homeScore < awayScore) {
                        result = '2';
                    } else {
                        result = 'X';
                    }

                    statusDiv.innerHTML = `
                        <div class="match-status finished">
                            ‚úÖ Match Termin√© !<br>
                            Score: ${currentTeams.team1} ${homeScore} - ${awayScore} ${currentTeams.team2}<br>
                            R√©sultat: ${result === '1' ? currentTeams.team1 + ' gagne' : result === 'X' ? 'Match Nul' : currentTeams.team2 + ' gagne'}
                        </div>
                    `;

                    // Enregistrer automatiquement le r√©sultat
                    setTimeout(() => {
                        registerResult(result);
                    }, 2000);

                } else if (status === '1H' || status === '2H' || status === 'HT' || status === 'ET' || status === 'BT' || status === 'P' || status === 'LIVE') {
                    // Match en cours
                    statusDiv.innerHTML = `
                        <div class="match-status live">
                            ‚öΩ Match EN COURS !<br>
                            Score actuel: ${currentTeams.team1} ${homeScore} - ${awayScore} ${currentTeams.team2}<br>
                            Reviens quand le match sera termin√©
                        </div>
                    `;
                } else if (status === 'NS' || status === 'TBD') {
                    // Match pas encore commenc√©
                    const kickoffDate = new Date(fixture.fixture.date);
                    statusDiv.innerHTML = `
                        <div class="match-status not-started">
                            ‚è∞ Match pas encore commenc√©<br>
                            Coup d'envoi: ${kickoffDate.toLocaleDateString('fr-FR', {
                                day: 'numeric',
                                month: 'long',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </div>
                    `;
                } else if (status === 'PST' || status === 'CANC' || status === 'ABD') {
                    // Match report√©/annul√©
                    statusDiv.innerHTML = `
                        <div class="match-status" style="background: rgba(244, 67, 54, 0.2); border-color: #f44336; color: #ff6b6b;">
                            ‚ùå Match ${status === 'PST' ? 'Report√©' : status === 'CANC' ? 'Annul√©' : 'Abandonn√©'}<br>
                            Impossible de r√©cup√©rer le r√©sultat
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div class="match-status">
                            ‚ÑπÔ∏è Statut: ${status}<br>
                            V√©rifiez manuellement ou r√©essayez plus tard
                        </div>
                    `;
                }

            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="match-status" style="background: rgba(244, 67, 54, 0.2); border-color: #f44336; color: #ff6b6b;">
                        ‚ùå Erreur: ${error.message}<br>
                        R√©essayez ou enregistrez manuellement
                    </div>
                `;
            }

            btn.disabled = false;
            btn.textContent = 'üîÑ V√©rifier le R√©sultat Automatiquement';
        }
    </script>
</body>
</html>
